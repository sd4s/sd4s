--REDSHIFT dependencies with MATERIALIZED-VIEW: mv_bom_item_comp_header
--

select * from pg_views where schemaname='sc_lims_dal' and definition like '%mv_bom_item_comp_header%'
--
/*
sc_lims_dal	av_reqov_bom_explosion_parts_nw	usr_eu_lims_dl_admin	WITH RECURSIVE tree(part_no, revision, plant, preferred, alternative, item_number, parent_part_no, parent_revision, parent_plant, parent_preferred, parent_alternative, phr_num_5, quantity, uom, characteristic, issued_date, root_part, root_revision, root_preferred, root_alternative, root_issued_date, lvl, "path", pathpartno, pathnode, parent_seq, parent_quantity, pathrelquantity) AS (SELECT DISTINCT mv.component_part AS part_no, (mv.comp_revision)::integer AS revision, mv.comp_plant AS plant, (mv.comp_preferred)::integer AS preferred, (mv.comp_alternative)::integer AS alternative, mv.item_number, mv.part_no AS parent_part_no, (mv.revision)::integer AS parent_revision, mv.plant AS parent_plant, (mv.preferred)::integer AS parent_preferred, (mv.alternative)::integer AS parent_alternative, mv.phr_num_5, mv.quantity, mv.uom, mv.characteristic, mv.issued_date, mv.part_no AS root_part, mv.revision AS root_revision, mv.preferred AS root_preferred, mv.alternative AS root_alternative, mv.issued_date AS root_issued_date, 1 AS lvl, ("substring"((('0000'::text || '.'::text) || to_char((mv.item_number)::double precision, '0999'::text)), 1, 120))::character varying(120) AS "path", ((((mv.part_no)::text || '#'::text) || (mv.component_part)::text))::character varying(2000) AS pathpartno, (to_char((mv.item_number)::double precision, '0999'::text))::character varying AS pathnode, mv.item_number AS parent_seq, mv.base_quantity AS parent_quantity, ((((mv.quantity)::character varying(100))::text || '/1'::text))::character varying(2000) AS pathrelquantity FROM mv_bom_item_comp_header mv WHERE ((abs(mv.preferred) = 1) AND (abs(mv.comp_preferred) = (1)::numeric)) UNION ALL SELECT mv2.component_part AS part_no, (mv2.comp_revision)::integer AS revision, mv2.comp_plant AS plant, (mv2.comp_preferred)::integer AS preferred, (mv2.comp_alternative)::integer AS alternative, t.item_number, t.part_no AS parent_part_no, t.revision AS parent_revision, (t.plant)::character varying(24) AS parent_plant, t.preferred AS parent_preferred, t.alternative AS parent_alternative, mv2.phr_num_5, mv2.quantity, mv2.uom, mv2.characteristic, t.issued_date, t.root_part, t.root_revision, t.root_preferred, t.root_alternative, t.root_issued_date, (t.lvl + 1) AS lvl, ("substring"((((t."path")::text || '.'::text) || to_char((mv2.item_number)::double precision, '0999'::text)), 1, 120))::character varying(120) AS "path", ((((t.pathpartno)::text || '#'::text) || (mv2.component_part)::text))::character varying(2000) AS pathpartno, (to_char((mv2.item_number)::double precision, '0999'::text))::character varying AS pathnode, t.item_number AS parent_seq, mv2.base_quantity AS parent_quantity, ((((t.pathrelquantity)::text || '*'::text) || ((((mv2.quantity)::character varying(100))::text || '/'::text) || ((mv2.base_quantity)::character varying(100))::text)))::character varying(2000) AS pathrelquantity FROM (tree t JOIN mv_bom_item_comp_header mv2 ON (((((((mv2.part_no)::text = (t.part_no)::text) AND (mv2.revision = t.revision)) AND ((mv2.plant)::text = (t.plant)::text)) AND (mv2.preferred = 1)) AND (abs(mv2.comp_preferred) = (1)::numeric)))) WHERE (t.lvl < 12)) SELECT tt.part_no, tt.revision, tt.plant, tt.preferred, tt.alternative, tt.item_number, tt.parent_part_no, tt.parent_revision, tt.parent_plant, tt.parent_preferred, tt.parent_alternative, tt.phr_num_5, tt.quantity, tt.uom, tt.characteristic, tt.issued_date, tt.root_part, tt.root_revision, tt.root_preferred, tt.root_alternative, tt.root_issued_date, tt.lvl, tt."path", tt.pathpartno, tt.pathnode, tt.parent_seq, tt.parent_quantity, tt.pathrelquantity FROM tree tt;
sc_lims_dal	av_reqov_bom_explosion_parts	usr_eu_lims_dl_admin	WITH RECURSIVE tree(part_no, revision, plant, preferred, alternative, item_number, parent_part_no, parent_revision, parent_plant, parent_preferred, parent_alternative, phr_num_5, quantity, uom, characteristic, issued_date, root_part, root_revision, root_preferred, root_alternative, root_issued_date, lvl, "path", pathpartno, pathnode, parent_seq, parent_quantity, pathrelquantity) AS (SELECT DISTINCT mv.component_part AS part_no, (mv.comp_revision)::integer AS revision, mv.comp_plant AS plant, (mv.comp_preferred)::integer AS preferred, (mv.comp_alternative)::integer AS alternative, mv.item_number, mv.part_no AS parent_part_no, (mv.revision)::integer AS parent_revision, mv.plant AS parent_plant, (mv.preferred)::integer AS parent_preferred, (mv.alternative)::integer AS parent_alternative, mv.phr_num_5, mv.quantity, mv.uom, mv.characteristic, mv.issued_date, mv.part_no AS root_part, mv.revision AS root_revision, mv.preferred AS root_preferred, mv.alternative AS root_alternative, mv.issued_date AS root_issued_date, 1 AS lvl, ("substring"((('0000'::text || '.'::text) || to_char((mv.item_number)::double precision, '0999'::text)), 1, 120))::character varying(120) AS "path", ((((mv.part_no)::text || '#'::text) || (mv.component_part)::text))::character varying(2000) AS pathpartno, (to_char((mv.item_number)::double precision, '0999'::text))::character varying AS pathnode, mv.item_number AS parent_seq, mv.base_quantity AS parent_quantity, ((((mv.quantity)::character varying(100))::text || '/1'::text))::character varying(2000) AS pathrelquantity FROM mv_bom_item_comp_header mv WHERE ((abs(mv.preferred) = 1) AND (abs(mv.comp_preferred) = (1)::numeric)) UNION ALL SELECT mv2.component_part AS part_no, (mv2.comp_revision)::integer AS revision, mv2.comp_plant AS plant, (mv2.comp_preferred)::integer AS preferred, (mv2.comp_alternative)::integer AS alternative, t.item_number, t.part_no AS parent_part_no, t.revision AS parent_revision, (t.plant)::character varying(24) AS parent_plant, t.preferred AS parent_preferred, t.alternative AS parent_alternative, mv2.phr_num_5, mv2.quantity, mv2.uom, mv2.characteristic, t.issued_date, t.root_part, t.root_revision, t.root_preferred, t.root_alternative, t.root_issued_date, (t.lvl + 1) AS lvl, ("substring"((((t."path")::text || '.'::text) || to_char((mv2.item_number)::double precision, '0999'::text)), 1, 120))::character varying(120) AS "path", ((((t.pathpartno)::text || '#'::text) || (mv2.component_part)::text))::character varying(2000) AS pathpartno, (to_char((mv2.item_number)::double precision, '0999'::text))::character varying AS pathnode, t.item_number AS parent_seq, mv2.base_quantity AS parent_quantity, ((((t.pathrelquantity)::text || '*'::text) || ((((mv2.quantity)::character varying(100))::text || '/'::text) || ((mv2.base_quantity)::character varying(100))::text)))::character varying(2000) AS pathrelquantity FROM (tree t JOIN mv_bom_item_comp_header mv2 ON (((((((mv2.part_no)::text = (t.part_no)::text) AND (mv2.revision = t.revision)) AND ((mv2.plant)::text = (t.plant)::text)) AND (mv2.preferred = 1)) AND (abs(mv2.comp_preferred) = (1)::numeric)))) WHERE (t.lvl < 12)) SELECT tt.part_no, tt.revision, tt.plant, tt.preferred, tt.alternative, tt.item_number, tt.parent_part_no, tt.parent_revision, tt.parent_plant, tt.parent_preferred, tt.parent_alternative, tt.phr_num_5, tt.quantity, tt.uom, tt.characteristic, tt.issued_date, tt.root_part, tt.root_revision, tt.root_preferred, tt.root_alternative, tt.root_issued_date, tt.lvl, tt."path", tt.pathpartno, tt.pathnode, tt.parent_seq, tt.parent_quantity, tt.pathrelquantity FROM tree tt;
sc_lims_dal	av_exec_db_partno_dispersion	usr_eu_lims_dl_admin	WITH RECURSIVE tree(part_no, revision, plant, item_number, status, parent_part, parent_rev, parent_status, alternative, preferred, phr, quantity, uom, characteristic, issued_date, root_part, root_rev, root_status, root_alternative, root_preferred, root_issued_date, lvl, lvl_tree, "path", pathnode, parent_branch, parent_seq, parent_quantity, normalized_quantity, branch, indentstr, breadcrumbs) AS (SELECT DISTINCT mv.component_part AS part_no, (mv.comp_revision)::integer AS revision, mv.plant, mv.item_number, mv.status, mv.part_no AS parent_part, (mv.revision)::integer AS parent_rev, mv.status AS parent_status, mv.alternative, mv.preferred, mv.phr_num_5 AS phr, mv.quantity, mv.uom, mv.characteristic, mv.issued_date, mv.part_no AS root_part, mv.revision AS root_rev, mv.status AS root_status, mv.alternative AS root_alternative, mv.preferred AS root_preferred, mv.issued_date AS root_issued_date, 1 AS lvl, ((rpad('.'::text, ((1 - 1) * 2), '.'::text) || '1'::text))::character varying AS lvl_tree, ('0000'::character varying)::character varying(200) AS "path", (to_char((mv.item_number)::double precision, '0999'::text))::character varying AS pathnode, (''::character varying)::character varying(100) AS parent_branch, mv.item_number AS parent_seq, mv.base_quantity AS parent_quantity, (((mv.quantity * (1)::numeric) / (1)::numeric))::numeric(18,0) AS normalized_quantity, (to_char((mv.item_number)::double precision, '0999'::text))::character varying(200) AS branch, (''::character varying)::character varying(200) AS indentstr, ('Top'::character varying)::character varying(200) AS breadcrumbs FROM mv_bom_item_comp_header mv WHERE ((mv.preferred = 1) AND (abs(mv.comp_preferred) = (1)::numeric)) UNION ALL SELECT mv2.component_part AS part_no, (mv2.comp_revision)::integer AS revision, mv2.plant, mv2.item_number, mv2.status, t.part_no AS parent_part, t.revision AS parent_rev, t.status AS parent_status, mv2.alternative, mv2.preferred, mv2.phr_num_5 AS phr, mv2.quantity, mv2.uom, mv2.characteristic, t.issued_date, t.root_part, t.root_rev, t.root_status, t.root_alternative, t.root_preferred, t.root_issued_date, (t.lvl + 1) AS lvl, ((rpad('.'::text, (t.lvl * 2), '.'::text) || ((t.lvl + 1))::text))::character varying AS lvl_tree, (("substring"((((t."path")::text || '.'::text) || (t.pathnode)::text), 1, 120))::character varying(120))::character varying(200) AS "path", (to_char((mv2.item_number)::double precision, '0999'::text))::character varying AS pathnode, (t.branch)::character varying(100) AS parent_branch, t.item_number AS parent_seq, mv2.base_quantity AS parent_quantity, (CASE WHEN ((mv2.base_quantity = (0)::numeric(17,7)) OR ((mv2.base_quantity IS NULL) AND (0 IS NULL))) THEN (0)::numeric ELSE ((mv2.quantity * t.normalized_quantity) / mv2.base_quantity) END)::numeric(18,0) AS normalized_quantity, ("substring"((((t.branch)::text || '.'::text) || to_char((mv2.item_number)::double precision, '0999'::text)), 1, 100))::character varying(200) AS branch, ("substring"(((t.indentstr)::text || ';'::text), 1, 200))::character varying(200) AS indentstr, ("substring"((((t.breadcrumbs)::text || ' / '::text) || (mv2.part_no)::text), 1, 200))::character varying(200) AS breadcrumbs FROM (tree t JOIN mv_bom_item_comp_header mv2 ON (((((((mv2.part_no)::text = (t.part_no)::text) AND ((mv2.revision)::integer = t.revision)) AND ((mv2.plant)::text = (t.plant)::text)) AND (mv2.preferred = 1)) AND (abs(mv2.comp_preferred) = (1)::numeric)))) WHERE (t.lvl < 12)) SELECT tt.part_no, tt.revision, tt.plant, tt.item_number, tt.status, tt.parent_part, tt.parent_rev, tt.parent_status, tt.alternative, tt.preferred, tt.phr, tt.quantity, tt.uom, tt.characteristic, tt.issued_date, tt.root_part, tt.root_rev, tt.root_status, tt.root_alternative, tt.root_preferred, tt.root_issued_date, tt.lvl, tt.lvl_tree, tt."path", tt.pathnode, tt.parent_branch, tt.parent_seq, tt.parent_quantity, tt.normalized_quantity, tt.branch, tt.indentstr, tt.breadcrumbs FROM tree tt ORDER BY tt.root_part, tt.lvl, tt.parent_part, tt.item_number;
*/

--request-overview:
DROP VIEW sc_lims_dal.av_reqov_bom_explosion_parts;
DROP VIEW sc_lims_dal.av_reqov_bom_explosion_parts_nw;
--execution dashboard:
DROP VIEW sc_lims_dal.av_exec_db_partno_dispersion;


--sc_lims_dal.SAMPLE_PART_NO_GROUPKEY
select * from pg_views where schemaname='sc_lims_dal' and definition like '%sc_lims_dal.SAMPLE_PART_NO_GROUPKEY%'


--eind script.


