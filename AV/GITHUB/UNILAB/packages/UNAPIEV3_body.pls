PACKAGE BODY unapiev3 AS

L_CNT                 NUMBER;
L_SQL_STRING          VARCHAR2(4000);
L_RESULT              NUMBER;
L_RET_CODE            NUMBER;
L_EV_SEQ_NR           NUMBER;
L_EVENT_TP            UTEV.EV_TP%TYPE;
L_TIMED_EVENT_TP      UTEV.EV_TP%TYPE;
L_EV_DETAILS          VARCHAR2(2000);

L_AR                  UNAPIGEN.CHAR1_TABLE_TYPE;
L_NR_OF_ROWS          NUMBER;
L_SS_STR              VARCHAR2(255);
L_TRANSITION_OK       INTEGER;
L_VALID_SPECSA        CHAR(1);
L_VALID_SPECSB        CHAR(1);
L_VALID_SPECSC        CHAR(1);
L_VALID_LIMITSA       CHAR(1);
L_VALID_LIMITSB       CHAR(1);
L_VALID_LIMITSC       CHAR(1);
L_VALID_TARGETA       CHAR(1);
L_VALID_TARGETB       CHAR(1);
L_VALID_TARGETC       CHAR(1);
L_ALARMS_HANDLED      CHAR(1);
L_CAL_RESULT          CHAR(1);
L_REF_DATE            TIMESTAMP WITH TIME ZONE;
L_DELAYED_TILL        TIMESTAMP WITH TIME ZONE;
L_ALLOW_MODIFY        CHAR(1);
L_ACTIVE              CHAR(1);
L_FETCHED             BOOLEAN;
L_ST                  VARCHAR2(20);
L_SVGK_VALUE          UNAPIGEN.VC40_TABLE_TYPE;
L_NEW_RQ              VARCHAR2(20);
L_DELETE_OLDER_THAN   TIMESTAMP WITH TIME ZONE;   
L_CURR_DIFF           INTEGER;
L_PREV_WEEK_NR        INTEGER;
L_SVALARMS_HANDLED    CHAR(1);
L_SVSC                UNAPIGEN.VC20_TABLE_TYPE;
L_SVPG                UNAPIGEN.VC20_TABLE_TYPE;
L_SVPGNODE            UNAPIGEN.LONG_TABLE_TYPE;
L_SVPA                UNAPIGEN.VC20_TABLE_TYPE;
L_SVPANODE            UNAPIGEN.LONG_TABLE_TYPE;
L_SVVALUE_F           UNAPIGEN.FLOAT_TABLE_TYPE;
L_SVVALUE_S           UNAPIGEN.VC40_TABLE_TYPE;
L_SVUNIT              UNAPIGEN.VC20_TABLE_TYPE;
L_SVEXEC_END_DATE     UNAPIGEN.DATE_TABLE_TYPE;
L_SVEXECUTOR          UNAPIGEN.VC20_TABLE_TYPE;
L_SVMANUALLY_ENTERED  UNAPIGEN.CHAR1_TABLE_TYPE;
L_SVREANALYSIS        UNAPIGEN.NUM_TABLE_TYPE;
L_SVMODIFY_FLAG       UNAPIGEN.NUM_TABLE_TYPE;
L_SVNR_OF_ROWS        NUMBER;
STPERROR              EXCEPTION;
L_FIELDTYPE_TAB       UNAPIGEN.VC20_TABLE_TYPE;
L_FIELDNAMES_TAB      UNAPIGEN.VC20_TABLE_TYPE;
L_FIELDVALUES_TAB     UNAPIGEN.VC40_TABLE_TYPE;
L_FIELDNR_OF_ROWS     NUMBER;

CURSOR L_SCRQSD_CURSOR(C_SC IN VARCHAR2) IS
   SELECT RQ, SD
   FROM UTSC
   WHERE SC = C_SC;

CURSOR L_SCPATD_CURSOR(C_ST VARCHAR2, C_ST_VERSION VARCHAR2, C_PG VARCHAR2, C_PA VARCHAR2) IS
   SELECT ROWID
   FROM UTSCPATD A
   WHERE A.ST = C_ST
   AND A.ST_VERSION = C_ST_VERSION
   AND A.PG = C_PG
   AND A.PA = C_PA
   ORDER BY A.EXEC_END_DATE DESC;

CURSOR L_WEEK_CURSOR (A_REF_DATE IN TIMESTAMP WITH TIME ZONE) IS
   SELECT DAY_OF_YEAR,WEEK_NR 
   FROM   UTWEEKNR
   WHERE DAY_OF_YEAR <= (TO_TIMESTAMP_TZ(TO_CHAR(TRUNC(A_REF_DATE AT TIME ZONE DBTIMEZONE,'DD'),'DD/MM/YYYY HH24:MI:SS ')||DBTIMEZONE, 'DD/MM/YYYY HH24:MI:SS TZR')AT TIME ZONE SESSIONTIMEZONE)
   ORDER BY DAY_OF_YEAR DESC;
L_WEEK_REC             L_WEEK_CURSOR%ROWTYPE;

CURSOR L_SC_CURSOR (C_SC VARCHAR2) IS
   SELECT SC_CLASS, ST, ST_VERSION, SAMPLING_DATE
   FROM UTSC
   WHERE SC = C_SC;
L_SC_REC L_SC_CURSOR%ROWTYPE;

CURSOR L_RQ_CURSOR (A_RQ VARCHAR2) IS
   SELECT A.RQ_CLASS, A.RT, A.RT_VERSION, A.SAMPLING_DATE, NVL(B.ADD_STPP, '0') ADD_STPP
   FROM UTRQ A, UTRT B
   WHERE A.RQ = A_RQ
   AND A.RT = B.RT(+)
   AND A.RT_VERSION = B.VERSION(+);
L_RQ_REC L_RQ_CURSOR%ROWTYPE;


CURSOR L_SD_CURSOR (A_SD VARCHAR2) IS
   SELECT A.SD_CLASS, A.PT, A.PT_VERSION
   FROM UTSD A, UTPT B
   WHERE A.SD = A_SD
   AND A.PT = B.PT(+)
   AND A.PT_VERSION = B.VERSION(+);
L_SD_REC L_SD_CURSOR%ROWTYPE;


CURSOR L_SCIC_COMPLETED_CURSOR (A_SC VARCHAR2, A_IC VARCHAR2, A_ICNODE NUMBER) IS
   SELECT COUNT(IIVALUE) FILLED_IN, COUNT(SC) TOTAL
   FROM UTSCII
   WHERE SC = A_SC
   AND IC = A_IC
   AND ICNODE = A_ICNODE;
L_SCIC_COMPLETED_REC L_SCIC_COMPLETED_CURSOR%ROWTYPE;

CURSOR L_RQIC_COMPLETED_CURSOR (A_RQ VARCHAR2, A_IC VARCHAR2, A_ICNODE NUMBER) IS
   SELECT COUNT(IIVALUE) FILLED_IN, COUNT(RQ) TOTAL
   FROM UTRQII
   WHERE RQ = A_RQ
   AND IC = A_IC
   AND ICNODE = A_ICNODE;
L_RQIC_COMPLETED_REC L_RQIC_COMPLETED_CURSOR%ROWTYPE;

CURSOR L_SDIC_COMPLETED_CURSOR (A_SD VARCHAR2, A_IC VARCHAR2, A_ICNODE NUMBER) IS
   SELECT COUNT(IIVALUE) FILLED_IN, COUNT(SD) TOTAL
   FROM UTSDII
   WHERE SD = A_SD
   AND IC = A_IC
   AND ICNODE = A_ICNODE;
L_SDIC_COMPLETED_REC L_SDIC_COMPLETED_CURSOR%ROWTYPE;

CURSOR L_EQ_CURSOR (A_EQ VARCHAR2, A_LAB VARCHAR2) IS
   SELECT KEEP_CTOLD, KEEP_CTOLD_UNIT 
   FROM UTEQ
   WHERE EQ = A_EQ
   AND LAB = A_LAB;
L_EQ_REC L_EQ_CURSOR%ROWTYPE;

CURSOR L_EQCTLIST_CURSOR (A_EQ VARCHAR2, A_LAB VARCHAR2) IS
   SELECT DISTINCT CT_NAME, SEQ
   FROM UTEQCT
   WHERE EQ = A_EQ
   AND LAB = A_LAB;
L_EQCTLIST_REC L_EQCTLIST_CURSOR%ROWTYPE;

CURSOR L_EQCTOLD_CURSOR (A_EQ VARCHAR2, A_LAB VARCHAR2, A_SEQ VARCHAR2) IS
   SELECT EXEC_START_DATE
   FROM UTEQCTOLD
   WHERE EQ = A_EQ
   AND LAB = A_LAB
   AND SEQ=A_SEQ
   ORDER BY EXEC_START_DATE DESC;
L_EQCTOLD_REC L_EQCTOLD_CURSOR%ROWTYPE;

FUNCTION GETVERSION
   RETURN VARCHAR2
IS
BEGIN
   RETURN('06.07.00.00_00.13');
EXCEPTION
   WHEN OTHERS THEN
      RETURN (NULL);
END GETVERSION;


PROCEDURE SAVEPOINT_UNILAB4 IS
BEGIN
   IF UNAPIEV.P_EVMGRS_EV_IN_BULK = '1' THEN
      UNAPIGEN.U4SAVEPOINT('unilab4');
   ELSE
      SAVEPOINT UNILAB4;
   END IF;
END SAVEPOINT_UNILAB4;
 

PROCEDURE DELETEUCAUDITTRAIL   
(A_OBJECT_TP IN VARCHAR2,      
 A_OBJECT_ID IN VARCHAR2)      
IS




BEGIN

   DELETE FROM UTUCAUDITTRAIL
   WHERE CURR_VAL = A_OBJECT_ID;

END DELETEUCAUDITTRAIL;





PROCEDURE HANDLEOBJECTEVENTS   
IS

L_BIND_OBJ BOOLEAN;
L_BIND_EQ  BOOLEAN;
L_BIND_PP  BOOLEAN;

BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP IN ('ObjectCreated',
                                 'ObjectCopied')THEN
                                
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ObjectCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                    UNAPIEV.P_EV_REC.OBJECT_ID,
                                                    L_AR);
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
      END IF;
      IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
         
         L_SQL_STRING := 'UPDATE ut' || UNAPIEV.P_EV_REC.OBJECT_TP || ' SET ';
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            IF I < UNAPIGEN.P_DATADOMAINS THEN
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
            ELSE
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
            END IF;
         END LOOP;
         L_BIND_OBJ := FALSE;
         L_BIND_EQ := FALSE;
         L_BIND_PP := FALSE;
         IF UNAPIEV.P_EV_REC.OBJECT_TP NOT IN ('pp', 'eq') THEN
            L_SQL_STRING := L_SQL_STRING || ' WHERE ' || UNAPIEV.P_EV_REC.OBJECT_TP ||
                            ' = :object_id ' || 
                            'AND version = :version '; 
            L_BIND_OBJ := TRUE;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            L_SQL_STRING := L_SQL_STRING || ' WHERE ' ||
                            'eq = :object_id ' || 
                            'AND version = :version ' || 
                            'AND lab = :lab '; 
            L_BIND_EQ := TRUE;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            L_SQL_STRING := L_SQL_STRING || ' WHERE pp= :object_id ' || 
                            'AND version = :version ' || 
                            'AND pp_key1 = :pp_key1 ' || 
                            'AND pp_key2 = :pp_key2 ' || 
                            'AND pp_key3 = :pp_key3 ' || 
                            'AND pp_key4 = :pp_key4 ' || 
                            'AND pp_key5 = :pp_key5 ' ;  
            L_BIND_PP := TRUE;
         END IF;                         
         DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
         END LOOP;
         IF L_BIND_OBJ THEN
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':object_id', UNAPIEV.P_EV_REC.OBJECT_ID);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':version', UNAPIEV.P_VERSION);
         ELSIF L_BIND_EQ THEN
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':object_id', UNAPIEV.P_EV_REC.OBJECT_ID);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':version', UNAPIEV.P_VERSION);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':lab', UNAPIEV.P_LAB);
         ELSIF L_BIND_PP THEN
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':object_id', UNAPIEV.P_EV_REC.OBJECT_ID);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':version', UNAPIEV.P_VERSION);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':pp_key1', UNAPIEV.P_PP_KEY1);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':pp_key2', UNAPIEV.P_PP_KEY2);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':pp_key3', UNAPIEV.P_PP_KEY3);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':pp_key4', UNAPIEV.P_PP_KEY4);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':pp_key5', UNAPIEV.P_PP_KEY5);
         END IF;
         L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
      END IF;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('ObjectImported',
                                    'ObjectUpdated',
                                    'ObjectBecomesCurrent',
                                    'StGroupKeyUpdated',
                                    'RtGroupKeyUpdated',
                                    'PtGroupKeyUpdated',
                                    'DcGroupKeyUpdated',

                                    'MtMeasurementRangesUpdated',
                                    'MtExperienceLevelUpdated',
                                    'UsExperienceLevelUpdated',
                                    'ObjectCloned',
                                    'EnterprUs1StConnect') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP );
      END IF;

      IF UNAPIEV.P_EV_REC.EV_TP = 'ObjectBecomesCurrent' THEN
         
         
         

         
         
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            L_RET_CODE := UNAPIEV.COPYPPASSIGNFREQ(UNAPIEV.P_EV_REC.OBJECT_ID, 
                                                   UNAPIEV.P_OLD_CURRENT_VERSION, 
                                                   UNAPIEV.P_VERSION,
                                                   UNAPIEV.P_PP_KEY1,
                                                   UNAPIEV.P_PP_KEY2,
                                                   UNAPIEV.P_PP_KEY3,
                                                   UNAPIEV.P_PP_KEY4,
                                                   UNAPIEV.P_PP_KEY5);
         ELSE
            L_RET_CODE := UNAPIEV.COPYASSIGNFREQ(UNAPIEV.P_EV_REC.OBJECT_TP, 
                                                 UNAPIEV.P_EV_REC.OBJECT_ID, 
                                                 UNAPIEV.P_OLD_CURRENT_VERSION, 
                                                 UNAPIEV.P_VERSION);
         END IF;
         
         
         
         
         L_RET_CODE := UNAPIEV.CLEANSTBASEDASSIGNFREQ(UNAPIEV.P_EV_REC.OBJECT_ID, 
                       UNAPIEV.P_OLD_CURRENT_VERSION);
      END IF;
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'AttributesUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('AttributesUpdated');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ObjectStatusChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ObjectStatusChanged');
      END IF;
   
      
      
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ObjectCanceled' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ObjectCanceled');
      END IF;
   
      
      
      
      
      
      
      UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
            '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
            '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
            '#pp_key5='||UNAPIEV.P_PP_KEY5;
      ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
            '#lab='||UNAPIEV.P_LAB;
      ELSE
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
      END IF;
         
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ObjectLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ObjectLifeCycleChanged');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'UsedObjectsUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
          UNTRACE.LOG('UsedObjectsUpdated');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'AccessRightsUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
          UNTRACE.LOG('AccessRightsUpdated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('LayoutChanged',
                                    'LayoutCreated',
                                    'PpSpecsUpdated',
                                    'GroupKeyUpdated',
                                    'GroupKeyCreated',
                                    'SystemDefaultUpdated') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         IF UNAPIEV.P_EV_REC.OBJECT_TP = 'pp' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#pp_key1='||UNAPIEV.P_PP_KEY1||'#pp_key2='||UNAPIEV.P_PP_KEY2||
               '#pp_key3='||UNAPIEV.P_PP_KEY3||'#pp_key4='||UNAPIEV.P_PP_KEY4||
               '#pp_key5='||UNAPIEV.P_PP_KEY5;
         ELSIF UNAPIEV.P_EV_REC.OBJECT_TP = 'eq' THEN
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION||
               '#lab='||UNAPIEV.P_LAB;
         ELSE
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 'version='||UNAPIEV.P_VERSION;
         END IF;
      END IF;
         
      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('ObjectDeleted',
                                    'UsedObjectDeleted') THEN
                                   
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      NULL;
   END IF;
END HANDLEOBJECTEVENTS;

PROCEDURE HANDLECHEVENTS   
IS

BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'ChartCreated' THEN
                              
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ChartCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ch';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'cy_version='||UNAPIEV.P_CY_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                    UNAPIEV.P_EV_REC.OBJECT_ID,
                                                    L_AR);
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
      END IF;
      IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
         
         L_SQL_STRING := 'UPDATE utch SET ';
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            IF I < UNAPIGEN.P_DATADOMAINS THEN
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
            ELSE
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
            END IF;
         END LOOP;
         L_SQL_STRING := L_SQL_STRING || ' WHERE ch = :ch '; 
         DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
         END LOOP;
         DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ch', UNAPIEV.P_EV_REC.OBJECT_ID);
         L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
      END IF;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('ChartUpdated',
                                    'ChartDatapointUpdated',
                                    'ChartDatapointCreated',
                                    'ChAttributesUpdated',
                                    'ChAccessRightsUpdated',
                                    'ChGroupKeyUpdated') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP );
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ch';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'cy_version='||UNAPIEV.P_CY_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('ChartDeleted',
                                    'UsedObjectDeleted') THEN
                                   
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      NULL;
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ChStatusChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ChStatusChanged');
      END IF;
   
      
      
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ChCanceled' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ChCanceled');
      END IF;
   
      
      
      
      
      
      
      UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
         'cy_version='||UNAPIEV.P_CY_VERSION;
         
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ChLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ChLifeCycleChanged');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := UNAPIEV.P_EV_REC.OBJECT_TP;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'cy_version='||UNAPIEV.P_CY_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      IF UNAPIEV.P_EV_REC.OBJECT_TP <> 'pp' THEN
         L_RET_CODE := UNAPIGEN.EVALVERSION(UNAPIEV.P_EV_REC.OBJECT_TP, UNAPIEV.P_EV_REC.OBJECT_ID,
                                            UNAPIEV.P_VERSION);
      ELSE
         L_RET_CODE := UNAPIGEN.EVALPPVERSION(UNAPIEV.P_EV_REC.OBJECT_ID, UNAPIEV.P_VERSION,
                                              UNAPIEV.P_PP_KEY1, UNAPIEV.P_PP_KEY2, UNAPIEV.P_PP_KEY3,
                                              UNAPIEV.P_PP_KEY4, UNAPIEV.P_PP_KEY5);
      END IF;
   END IF;
END HANDLECHEVENTS;

PROCEDURE UPDATESCALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)

IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_SCOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTSC
   WHERE SC = UNAPIEV.P_SC;
   
BEGIN

   
   OPEN L_SCOLDDATES_CURSOR;
   FETCH L_SCOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_SCOLDDATES_CURSOR;
   L_NEW_START_DATE_TZ := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ   := L_OLD_END_DATE;
   L_NEW_START_DATE    := L_OLD_START_DATE;
   L_NEW_END_DATE      := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
      
      
      
      UPDATE UTSC A
      SET A.EXEC_START_DATE = 
         (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
          FROM UTSCPG B 
          WHERE B.SC = UNAPIEV.P_SC),
     A.EXEC_START_DATE_TZ = 
         (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
          FROM UTSCPG B 
          WHERE B.SC = UNAPIEV.P_SC)
      WHERE A.SC = UNAPIEV.P_SC
        AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN  

         L_RET_CODE := UNAPISC.UPDATELINKEDSCII
                          (UNAPIEV.P_SC, 'exec_start_date', '0', '', '', '',
                          '', '', '',
                          '', '', L_NEW_START_DATE,
                          '', '', '',
                          '', '', '', '',
                          '', '', '', '', '',
                          '', '');
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;
      END IF;
   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTSC A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.PG),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) FROM UTSCPG B WHERE B.SC = UNAPIEV.P_SC),
   A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.PG),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE_TZ) FROM UTSCPG B WHERE B.SC = UNAPIEV.P_SC)
      WHERE A.SC = UNAPIEV.P_SC
        AND A.EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN

         L_RET_CODE := UNAPISC.UPDATELINKEDSCII
                          (UNAPIEV.P_SC, 'exec_end_date', '0', '', '', '',
                          '', '', '',
                          '', '', '',
                          L_NEW_END_DATE, '', '',
                          '', '', '', '',
                          '', '', '', '', '',
                          '', '');
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;
      END IF;
   END IF;
   
   IF L_LOG_HS_DETAILS = 1 THEN
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTSCHSDETAILS (SC, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
           'sample "'||UNAPIEV.P_SC||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE_TZ), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTSCHSDETAILS (SC, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
          'sample "'||UNAPIEV.P_SC||'" is updated: property <exec_end_date_tz> changed value from "' ||
          TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;

EXCEPTION
WHEN OTHERS THEN
   IF L_SCOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_SCOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATESCALLDATES;

PROCEDURE UPDATERQALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)
IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_RQOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTRQ
   WHERE RQ = UNAPIEV.P_RQ;
   
BEGIN

   
   OPEN L_RQOLDDATES_CURSOR;
   FETCH L_RQOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_RQOLDDATES_CURSOR;
   L_NEW_START_DATE      := L_OLD_START_DATE;
   L_NEW_END_DATE        := L_OLD_END_DATE;
   L_NEW_START_DATE_TZ   := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ     := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
      
      
      
      UPDATE UTRQ A
      SET A.EXEC_START_DATE = 
         (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
          FROM UTSC B, UTRQSC C 
          WHERE B.SC = C.SC
          AND C.RQ = UNAPIEV.P_RQ),
     A.EXEC_START_DATE_TZ = 
         (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
          FROM UTSC B, UTRQSC C 
          WHERE B.SC = C.SC
          AND C.RQ = UNAPIEV.P_RQ)
      WHERE A.RQ = UNAPIEV.P_RQ
        AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN

         L_RET_CODE := UNAPIRQ.UPDATELINKEDRQII
                         (UNAPIEV.P_RQ, 'exec_start_date', '0', '', '', '',
                          '', '', '', '',
                          '', L_NEW_START_DATE, '',
                          '', '', '', '',
                          '', '', '', '',
                          '', '', '',
                          '');

         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;
      END IF;
   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTRQ A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.SC),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) 
          FROM UTSC B, UTRQSC C WHERE B.SC = C.SC AND C.RQ = UNAPIEV.P_RQ ),
      A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.SC),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE) 
          FROM UTSC B, UTRQSC C WHERE B.SC = C.SC AND C.RQ = UNAPIEV.P_RQ )
      WHERE A.RQ = UNAPIEV.P_RQ
        AND A.EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN

         L_RET_CODE := UNAPIRQ.UPDATELINKEDRQII
                         (UNAPIEV.P_RQ, 'exec_end_date', '0', '', '', '',
                          '', '', '', '',
                          '', '', L_NEW_END_DATE,
                          '', '', '', '',
                          '', '', '', '',
                          '', '', '',
                          '');
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;

      END IF;
   END IF;
   
   IF L_LOG_HS_DETAILS = 1 THEN
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTRQHSDETAILS (RQ, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_RQ, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
           'request "'||UNAPIEV.P_RQ||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE_TZ), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTRQHSDETAILS (RQ, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_RQ, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
          'request "'||UNAPIEV.P_RQ||'" is updated: property <exec_end_date_tz> changed value from "' ||
          TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;

EXCEPTION
WHEN OTHERS THEN
   IF L_RQOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_RQOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATERQALLDATES;

PROCEDURE UPDATESCPGALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)
IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_SCPGOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTSCPG
   WHERE SC = UNAPIEV.P_SC
   AND PG = UNAPIEV.P_PG
   AND PGNODE = UNAPIEV.P_PGNODE;
   
BEGIN

   
   OPEN L_SCPGOLDDATES_CURSOR;
   FETCH L_SCPGOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_SCPGOLDDATES_CURSOR;
   L_NEW_START_DATE    := L_OLD_START_DATE;
   L_NEW_END_DATE      := L_OLD_END_DATE;
   L_NEW_START_DATE_TZ := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ   := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
         
         
         
         UPDATE UTSCPG A
         SET A.EXEC_START_DATE = 
            (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
             FROM UTSCPA B 
             WHERE B.SC = UNAPIEV.P_SC
               AND B.PG = UNAPIEV.P_PG
               AND B.PGNODE = UNAPIEV.P_PGNODE),
        A.EXEC_START_DATE_TZ = 
            (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
             FROM UTSCPA B 
             WHERE B.SC = UNAPIEV.P_SC
               AND B.PG = UNAPIEV.P_PG
               AND B.PGNODE = UNAPIEV.P_PGNODE)
         WHERE A.SC = UNAPIEV.P_SC
           AND A.PG = UNAPIEV.P_PG
           AND A.PGNODE = UNAPIEV.P_PGNODE
           AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;
   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTSCPG A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.PA),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) FROM UTSCPA B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE),
     A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.PA),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE_TZ) FROM UTSCPA B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE)
      WHERE A.SC = UNAPIEV.P_SC
        AND A.PG = UNAPIEV.P_PG
        AND A.PGNODE = UNAPIEV.P_PGNODE
        AND A.EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;
   END IF;
   
   
   IF L_LOG_HS_DETAILS = '1' THEN 
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL) THEN 
         INSERT INTO UTSCPGHSDETAILS (SC, PG, PGNODE, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIEV.P_PG, UNAPIEV.P_PGNODE, 
            UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, 1, 'parameter group "'||UNAPIEV.P_PG||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE IS NULL) THEN 
         INSERT INTO UTSCPGHSDETAILS (SC, PG, PGNODE, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIEV.P_PG, UNAPIEV.P_PGNODE, 
            UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, 1, 'parameter group "'||UNAPIEV.P_PG||'" is updated: property <exec_end_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;

EXCEPTION
WHEN OTHERS THEN
   IF L_SCPGOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_SCPGOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATESCPGALLDATES;

PROCEDURE UPDATESCPAALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)
IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_SCPAOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTSCPA
   WHERE SC = UNAPIEV.P_SC
   AND PG = UNAPIEV.P_PG
   AND PGNODE = UNAPIEV.P_PGNODE
   AND PA = UNAPIEV.P_PA
   AND PANODE = UNAPIEV.P_PANODE;
   
BEGIN

   
   OPEN L_SCPAOLDDATES_CURSOR;
   FETCH L_SCPAOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_SCPAOLDDATES_CURSOR;
   L_NEW_START_DATE    := L_OLD_START_DATE;
   L_NEW_END_DATE      := L_OLD_END_DATE;
   L_NEW_START_DATE_TZ := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ   := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
      
      
      
      UPDATE UTSCPA A
      SET A.EXEC_START_DATE = 
         (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
          FROM UTSCME B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE
            AND B.PA = UNAPIEV.P_PA
            AND B.PANODE = UNAPIEV.P_PANODE),
     A.EXEC_START_DATE_TZ = 
         (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
          FROM UTSCME B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE
            AND B.PA = UNAPIEV.P_PA
            AND B.PANODE = UNAPIEV.P_PANODE)
      WHERE A.SC = UNAPIEV.P_SC
        AND A.PG = UNAPIEV.P_PG
        AND A.PGNODE = UNAPIEV.P_PGNODE
        AND A.PA = UNAPIEV.P_PA
        AND A.PANODE = UNAPIEV.P_PANODE
        AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;
   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTSCPA A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.ME),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) FROM UTSCME B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE
            AND B.PA = UNAPIEV.P_PA
            AND B.PANODE = UNAPIEV.P_PANODE),
     A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.ME),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE) FROM UTSCME B 
          WHERE B.SC = UNAPIEV.P_SC
            AND B.PG = UNAPIEV.P_PG
            AND B.PGNODE = UNAPIEV.P_PGNODE
            AND B.PA = UNAPIEV.P_PA
            AND B.PANODE = UNAPIEV.P_PANODE)
      WHERE A.SC = UNAPIEV.P_SC
        AND A.PG = UNAPIEV.P_PG
        AND A.PGNODE = UNAPIEV.P_PGNODE
        AND A.PA = UNAPIEV.P_PA
        AND A.PANODE = UNAPIEV.P_PANODE
        AND A.EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;
   END IF;
   
   
   IF L_LOG_HS_DETAILS = '1' THEN 
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL)  THEN 
         INSERT INTO UTSCPAHSDETAILS (SC, PG, PGNODE, PA, PANODE, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIEV.P_PG, UNAPIEV.P_PGNODE, UNAPIEV.P_PA, UNAPIEV.P_PANODE, 
            UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, 1, 'parameter "'||UNAPIEV.P_PG||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE_TZ), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE_TZ IS NULL)  THEN 
         INSERT INTO UTSCPAHSDETAILS (SC, PG, PGNODE, PA, PANODE, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SC, UNAPIEV.P_PG, UNAPIEV.P_PGNODE, UNAPIEV.P_PA, UNAPIEV.P_PANODE, 
            UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, 1, 'parameter "'||UNAPIEV.P_PG||'" is updated: property <exec_end_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;         

EXCEPTION
WHEN OTHERS THEN
   IF L_SCPAOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_SCPAOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATESCPAALLDATES;

PROCEDURE UPDATEWSALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)

IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_WSOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTWS
   WHERE WS = UNAPIEV.P_WS;
   
BEGIN

   
   OPEN L_WSOLDDATES_CURSOR;
   FETCH L_WSOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_WSOLDDATES_CURSOR;
   L_NEW_START_DATE    := L_OLD_START_DATE;
   L_NEW_END_DATE      := L_OLD_END_DATE;
   L_NEW_START_DATE_TZ := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ   := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
      
      
               
      UPDATE UTWS A
      SET A.EXEC_START_DATE = 
         (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
          FROM UTSCME B , UTWSME C
          WHERE C.WS = UNAPIEV.P_WS
            AND C.SC = B.SC
            AND C.PG = B.PG
            AND C.PGNODE = B.PGNODE
            AND C.PA = B.PA
            AND C.PANODE = B.PANODE
            AND C.ME = B.ME
            AND C.MENODE = B.MENODE),
     A.EXEC_START_DATE_TZ = 
         (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
          FROM UTSCME B , UTWSME C
          WHERE C.WS = UNAPIEV.P_WS
            AND C.SC = B.SC
            AND C.PG = B.PG
            AND C.PGNODE = B.PGNODE
            AND C.PA = B.PA
            AND C.PANODE = B.PANODE
            AND C.ME = B.ME
            AND C.MENODE = B.MENODE)
      WHERE A.WS = UNAPIEV.P_WS
      AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;

   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTWS A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.ME),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) FROM UTSCME B , UTWSME C
          WHERE C.WS = UNAPIEV.P_WS
            AND C.SC = B.SC
            AND C.PG = B.PG
            AND C.PGNODE = B.PGNODE
            AND C.PA = B.PA
            AND C.PANODE = B.PANODE
            AND C.ME = B.ME
            AND C.MENODE = B.MENODE),
      A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.ME),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE_TZ) FROM UTSCME B , UTWSME C
          WHERE C.WS = UNAPIEV.P_WS
            AND C.SC = B.SC
            AND C.PG = B.PG
            AND C.PGNODE = B.PGNODE
            AND C.PA = B.PA
            AND C.PANODE = B.PANODE
            AND C.ME = B.ME
            AND C.MENODE = B.MENODE)
      WHERE A.WS = UNAPIEV.P_WS
        AND EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;

   END IF;
   
   IF L_LOG_HS_DETAILS = 1 THEN
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTWSHSDETAILS (WS, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_WS, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
           'worksheet "'||UNAPIEV.P_WS||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE_TZ), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTWSHSDETAILS (WS, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_WS, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
          'worksheet "'||UNAPIEV.P_WS||'" is updated: property <exec_end_date_tz> changed value from "' ||
          TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;

EXCEPTION
WHEN OTHERS THEN
   IF L_WSOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_WSOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATEWSALLDATES;

PROCEDURE UPDATESDALLDATES
(A_UPDATE_START_DATE IN BOOLEAN,
 A_UPDATE_END_DATE IN BOOLEAN)
IS

L_OLD_START_DATE      TIMESTAMP WITH TIME ZONE;
L_OLD_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE      TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE        TIMESTAMP WITH TIME ZONE;
L_NEW_START_DATE_TZ   TIMESTAMP WITH TIME ZONE;
L_NEW_END_DATE_TZ     TIMESTAMP WITH TIME ZONE;
L_LOG_HS_DETAILS      CHAR(1);

CURSOR L_SDOLDDATES_CURSOR IS
   SELECT LOG_HS_DETAILS, EXEC_START_DATE_TZ, EXEC_END_DATE_TZ
   FROM UTSD
   WHERE SD = UNAPIEV.P_SD;
   
BEGIN

   
   OPEN L_SDOLDDATES_CURSOR;
   FETCH L_SDOLDDATES_CURSOR
   INTO L_LOG_HS_DETAILS, L_OLD_START_DATE, L_OLD_END_DATE;
   CLOSE L_SDOLDDATES_CURSOR;
   L_NEW_START_DATE    := L_OLD_START_DATE;
   L_NEW_END_DATE      := L_OLD_END_DATE;
   L_NEW_START_DATE_TZ := L_OLD_START_DATE;
   L_NEW_END_DATE_TZ   := L_OLD_END_DATE;

   IF A_UPDATE_START_DATE THEN
      
      
      
      UPDATE UTSD A
      SET A.EXEC_START_DATE = 
         (SELECT NVL(MIN(B.EXEC_START_DATE),A.EXEC_START_DATE) 
          FROM UTSC B, UTSDCELLSC C 
          WHERE B.SC = C.SC
          AND C.SD = UNAPIEV.P_SD),
    A.EXEC_START_DATE_TZ = 
         (SELECT NVL(MIN(B.EXEC_START_DATE_TZ),A.EXEC_START_DATE_TZ) 
          FROM UTSC B, UTSDCELLSC C 
          WHERE B.SC = C.SC
          AND C.SD = UNAPIEV.P_SD)
      WHERE A.SD = UNAPIEV.P_SD
        AND A.EXEC_START_DATE IS NULL
      RETURNING EXEC_START_DATE, EXEC_START_DATE_TZ
      INTO L_NEW_START_DATE, L_NEW_START_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN

         L_RET_CODE := UNAPISD.UPDATELINKEDSDII
                          (A_SD                  => UNAPIEV.P_SD,
                           A_SD_STD_PROPERTY     => 'exec_start_date',
                           A_SD_CREATION         => '0',
                           A_PT                  => '',
                           A_PT_VERSION          => '',
                           A_DESCRIPTION         => '',
                           A_DESCR_DOC           => '',
                           A_DESCR_DOC_VERSION   => '',
                           A_RESPONSIBLE         => '',
                           A_LABEL_FORMAT        => '',
                           A_CREATION_DATE       => '',
                           A_CREATED_BY          => '',
                           A_EXEC_START_DATE     => L_NEW_START_DATE,
                           A_EXEC_END_DATE       => '',
                           A_T0_DATE             => '',
                           A_NR_SC_CURRENT       => '');
         
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;
      END IF;
   END IF;

   IF A_UPDATE_END_DATE THEN
      
      
      
      UPDATE UTSD A
      SET A.EXEC_END_DATE = 
         (SELECT DECODE(COUNT(B.SC),COUNT(B.EXEC_END_DATE),MAX(B.EXEC_END_DATE),
                        A.EXEC_END_DATE) 
          FROM UTSC B, UTSDCELLSC C WHERE B.SC = C.SC AND C.SD = UNAPIEV.P_SD ),
     A.EXEC_END_DATE_TZ = 
         (SELECT DECODE(COUNT(B.SC),COUNT(B.EXEC_END_DATE_TZ),MAX(B.EXEC_END_DATE_TZ),
                        A.EXEC_END_DATE) 
          FROM UTSC B, UTSDCELLSC C WHERE B.SC = C.SC AND C.SD = UNAPIEV.P_SD )
      WHERE A.SD = UNAPIEV.P_SD
        AND A.EXEC_END_DATE IS NULL
      RETURNING EXEC_END_DATE, EXEC_END_DATE_TZ
      INTO L_NEW_END_DATE, L_NEW_END_DATE_TZ;

      
      
      
      IF SQL%ROWCOUNT > 0 THEN

         L_RET_CODE := UNAPISD.UPDATELINKEDSDII
                          (A_SD                  => UNAPIEV.P_SD,
                           A_SD_STD_PROPERTY     => 'exec_end_date',
                           A_SD_CREATION         => '0',
                           A_PT                  => '',
                           A_PT_VERSION          => '',
                           A_DESCRIPTION         => '',
                           A_DESCR_DOC           => '',
                           A_DESCR_DOC_VERSION   => '',
                           A_RESPONSIBLE         => '',
                           A_LABEL_FORMAT        => '',
                           A_CREATION_DATE       => '',
                           A_CREATED_BY          => '',
                           A_EXEC_START_DATE     => '',
                           A_EXEC_END_DATE       => L_NEW_END_DATE,
                           A_T0_DATE             => '',
                           A_NR_SC_CURRENT       => '');
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
            RAISE STPERROR;
         END IF;

      END IF;
   END IF;
   
   IF L_LOG_HS_DETAILS = 1 THEN
      IF NVL((L_OLD_START_DATE <> L_NEW_START_DATE_TZ), TRUE) AND NOT(L_OLD_START_DATE IS NULL AND L_NEW_START_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTSDHSDETAILS (SD, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SD, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
           'study "'||UNAPIEV.P_SD||'" is updated: property <exec_start_date_tz> changed value from "' ||
         TO_CHAR(L_OLD_START_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_START_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
      IF NVL((L_OLD_END_DATE <> L_NEW_END_DATE_TZ), TRUE) AND NOT(L_OLD_END_DATE IS NULL AND L_NEW_END_DATE_TZ IS NULL) THEN 
         UNAPIEV.P_HS_SEQ := UNAPIEV.P_HS_SEQ +1;
         INSERT INTO UTSDHSDETAILS (SD, TR_SEQ, EV_SEQ, SEQ, DETAILS)
         VALUES
         (UNAPIEV.P_SD, UNAPIGEN.P_TR_SEQ, UNAPIEV.P_EV_REC.EV_SEQ, UNAPIEV.P_HS_SEQ,
          'study "'||UNAPIEV.P_SD||'" is updated: property <exec_end_date_tz> changed value from "' ||
          TO_CHAR(L_OLD_END_DATE, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '" to "' || TO_CHAR(L_NEW_END_DATE_TZ, UNAPIGEN.P_JOBS_TSTZ_FORMAT) || '".');
      END IF;
   END IF;

EXCEPTION
WHEN OTHERS THEN
   IF L_SDOLDDATES_CURSOR%ISOPEN THEN
      CLOSE L_SDOLDDATES_CURSOR;
   END IF;
   RAISE;
END UPDATESDALLDATES;

PROCEDURE CASCADEONSDLEVEL 
IS
BEGIN
   UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
   UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
   UNAPIEV.P_EV_REC.OBJECT_LC := '';
   UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
   UNAPIEV.P_EV_REC.OBJECT_SS := '';
   UNAPIEV.P_SS_TO := '';
   

   L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

   
   IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
      UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
      UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
         'pt_version='||UNAPIEV.P_PT_VERSION;
   END IF;

   UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
   L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                  UNAPIEV.P_TR_NO, L_TRANSITION_OK);
END CASCADEONSDLEVEL;

PROCEDURE HANDLERQEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP IN ('RequestCreated',
                                 'RequestPlanned') THEN
                                
   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      DELETEUCAUDITTRAIL('rq', UNAPIEV.P_RQ);
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                    UNAPIEV.P_EV_REC.OBJECT_ID, 
                                                    L_AR);
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
      END IF;
      IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
         L_SQL_STRING := 'UPDATE utrq SET ';
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            IF I < UNAPIGEN.P_DATADOMAINS THEN
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
            ELSE
               L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
            END IF;
         END LOOP;
         L_SQL_STRING := L_SQL_STRING || ' WHERE rq = :rq ' ; 
                         
         DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
         FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
            DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
         END LOOP;
         DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':rq', UNAPIEV.P_RQ);
         L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
      END IF;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('RqStatusChanged',
                                    'RqCanceled')      THEN
                                   
      
      
      
      
      
      
      IF UNAPIEV.P_EV_REC.EV_TP = 'RqCanceled' THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqLifeCycleChanged');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('RequestUpdated', 
         'RequestImported',
         'RqAttributesUpdated',
         'RqAccessRightsUpdated', 
         'RqGroupKeyUpdated',
         'RqInfoCreated', 
         'RqSampleCreated', 
         'RqPpUpdated',
         'RqPpAttributesUpdated',
         'RequestCopied') THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('Rq1SampleAdded',
         'RqSamplesAdded') THEN
       
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      
      
      
      
      
      UNAPIEV3.UPDATERQALLDATES(TRUE, TRUE);
      
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqSampleRemoved' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqSampleRemoved');
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      
      
      UNAPIEV3.UPDATERQALLDATES(FALSE, TRUE);

      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'rt_version='||UNAPIEV.P_RT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RequestDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      NULL;
   END IF;
END HANDLERQEVENTS;

PROCEDURE HANDLESCEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP IN ('SampleCreated',
                                 'SamplePlanned') THEN
                                
   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         DELETEUCAUDITTRAIL('sc', UNAPIEV.P_SC);
         
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                       UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
         END IF;
         IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
            L_SQL_STRING := 'UPDATE utsc SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE sc = :sc ' ; 

            DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sc', UNAPIEV.P_SC);
            L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
         END IF;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         
         
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScStatusChanged' THEN
                                 

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         OPEN L_SCRQSD_CURSOR(UNAPIEV.P_SC);
         FETCH L_SCRQSD_CURSOR INTO UNAPIEV.P_RQ, UNAPIEV.P_SD;
         CLOSE L_SCRQSD_CURSOR;

         
         
         
         
      
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
                                                 
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScCanceled' THEN
                                 

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         OPEN L_SCRQSD_CURSOR(UNAPIEV.P_SC);
         FETCH L_SCRQSD_CURSOR INTO UNAPIEV.P_RQ, UNAPIEV.P_SD;
         CLOSE L_SCRQSD_CURSOR;

         
         
         
         

         
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'st_version='||UNAPIEV.P_ST_VERSION;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
                                        
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         
         
         
         
         
         
         UNAPIEV3.UPDATERQALLDATES(TRUE, TRUE);
           
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         
         
         
         
         
         
         UNAPIEV3.UPDATESDALLDATES(TRUE, TRUE);

         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ScLifeCycleChanged');
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                                UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('SampleUpdated', 
         'SampleImported',
         'ScInfoCreated', 
         'ScAnalysesCreated',
         'ScGroupKeyUpdated',
         'ScAttributesUpdated',
         'ScAccessRightsUpdated',
         'SampleCopied',
         'SampleExported',
         'ScTestPlanAdded',
         'SdScTpReachedSet') THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('TpUpFront', 
         'TpReached', 
         'TpOverdue') THEN
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

      IF UNAPIEV.P_CLIENT_EVMGR_USED = 'YES' THEN
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';

         
         L_RET_CODE := UNAPIEV.ALERTSEND(UNAPIEV.P_EV_REC.EV_TP,
                                         UNAPIEV.P_EV_REC.EV_DETAILS);
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS AND
             UNAPIEV.P_EV_OUTPUT_ON THEN
             UNTRACE.LOG('AlertSend#return=' || TO_CHAR(L_RET_CODE) ||
                         '#alert_name='||UNAPIEV.P_EV_REC.EV_TP ||
                         '#alert_details='||UNAPIEV.P_EV_REC.EV_DETAILS||'#sc='||UNAPIEV.P_SC);
         END IF;
      END IF;         

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SampleDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      OPEN L_SCRQSD_CURSOR(UNAPIEV.P_SC);
      FETCH L_SCRQSD_CURSOR INTO UNAPIEV.P_RQ, UNAPIEV.P_SD;
      CLOSE L_SCRQSD_CURSOR;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         
         
         
         UNAPIEV3.UPDATERQALLDATES(FALSE, TRUE);         

         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         
         
         
         UNAPIEV3.UPDATESDALLDATES(FALSE, TRUE);         

         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScSampleTypeChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         BEGIN
            SELECT ST
            INTO L_ST
            FROM UTSC
            WHERE SC = UNAPIEV.P_SC;
       
            L_RET_CODE := UNAPIEVP.INHERITNEWSPECS(UNAPIEV.P_SC, '~st~', L_ST);
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG('InheritNewSpecsReturned:'||L_RET_CODE);
            END IF;
         EXCEPTION
         WHEN NO_DATA_FOUND THEN
            INSERT INTO UTERROR(CLIENT_ID, APPLIC, WHO, LOGDATE, LOGDATE_TZ, API_NAME, ERROR_MSG)
            VALUES(UNAPIEV.P_EV_REC.CLIENT_ID, UNAPIEV.P_EV_REC.APPLIC, UNAPIGEN.P_USER, UNAPIEV2.L_CURRENT_TIMESTAMP, UNAPIEV2.L_CURRENT_TIMESTAMP,
            SUBSTR('Ev~'||TO_CHAR(UNAPIEV.P_EV_REC.EV_SEQ)||'~'||UNAPIEV.P_EV_REC.EV_TP,1,40), 
            'Warning#sc not found:'||UNAPIEV.P_SC);
         END;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScRequestModified' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ScRequestModified');
      END IF;

      

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_NEW_RQ := UNAPIEV.P_RQ;

      
      
      IF UNAPIEV.P_OLD_RQ IS NOT NULL THEN
         UNAPIEV.P_RQ := UNAPIEV.P_OLD_RQ;
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';

         
         
         
         UNAPIEV3.UPDATERQALLDATES(FALSE, TRUE);

         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_RQ := L_NEW_RQ;
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         
         
         
         
         
         
         UNAPIEV3.UPDATERQALLDATES(TRUE, TRUE);         

         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
      
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         
         
         
         
         
         
         UNAPIEV3.UPDATESDALLDATES(TRUE, TRUE);
         
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScActivate' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('ScActivate');
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         
         
         
         DELETE FROM UTDELAY
         WHERE SC = UNAPIEV.P_SC
         AND OBJECT_TP='sc';
           
         
         
         
         DELETE FROM UTEVTIMED
         WHERE OBJECT_TP = 'sc'
           AND OBJECT_ID = UNAPIEV.P_SC
           AND EV_TP = 'ScActivate';

         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   END IF;        
END HANDLESCEVENTS;

PROCEDURE HANDLESCICEVENTS   
IS
L_FIELDTYPE_TAB        UNAPIGEN.VC20_TABLE_TYPE;
L_FIELDNAMES_TAB       UNAPIGEN.VC20_TABLE_TYPE;
L_FIELDVALUES_TAB      UNAPIGEN.VC40_TABLE_TYPE;
L_FIELDNR_OF_ROWS      NUMBER;
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'InfoCardCreated' THEN
                              
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('InfoCardCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                       UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
         END IF;
         IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
            L_SQL_STRING := 'UPDATE utscic SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE sc = :sc ' || 
                            'AND ic = :ic ' || 
                            'AND icnode = :icnode ';

            DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sc', UNAPIEV.P_SC);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
            L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
         END IF;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('InfoCardCopied',
                                    'InfoCardUpdated',
                                    'IcLifeCycleChanged',
                                    'IcAttributesUpdated',
                                    'IcAccessRightsUpdated',
                                    'InfoFieldValuesChanged') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         
         
         OPEN L_SC_CURSOR(UNAPIEV.P_SC);
         FETCH L_SC_CURSOR INTO L_SC_REC;
      
         IF L_SC_CURSOR%NOTFOUND THEN
            UNAPIEV2.L_SQLERRM := 'sc ' || UNAPIEV.P_SC || ' does not exist !' ;
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
            END IF;
            RAISE STPERROR;
         ELSE
            IF L_SC_REC.SC_CLASS = '1' THEN
               OPEN L_SCIC_COMPLETED_CURSOR(UNAPIEV.P_SC, UNAPIEV.P_IC, UNAPIEV.P_ICNODE);
               FETCH L_SCIC_COMPLETED_CURSOR INTO L_SCIC_COMPLETED_REC;
               CLOSE L_SCIC_COMPLETED_CURSOR;

               IF L_SCIC_COMPLETED_REC.FILLED_IN = L_SCIC_COMPLETED_REC.TOTAL THEN
                  L_FIELDNR_OF_ROWS := 0;          
                  L_RET_CODE := UNAPISC.CREATESCANALYSESDETAILS
                                   (L_SC_REC.ST, L_SC_REC.ST_VERSION, UNAPIEV.P_SC,
                                    UNAPIGEN.PERFORM_FREQ_FILTERING,
                                    L_SC_REC.SAMPLING_DATE,
                                    L_FIELDTYPE_TAB , L_FIELDNAMES_TAB , L_FIELDVALUES_TAB, L_FIELDNR_OF_ROWS,
                                    'Infocard completed');
                  IF UNAPIEV.P_EV_OUTPUT_ON THEN
                     UNTRACE.LOG('CreateScAnalysesDetails called for '|| UNAPIEV.P_SC);
                  END IF;
                  IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
                     UNAPIEV2.L_SQLERRM :=  
                        'CreateScAnalysesDetails#return=' || TO_CHAR(L_RET_CODE) ||
                        '#sc=' || UNAPIEV.P_SC || 
                        '#st=' || L_SC_REC.ST || '#st_version=' || L_SC_REC.ST_VERSION || 
                        '#freq_filt=' || UNAPIGEN.PERFORM_FREQ_FILTERING ||
                        '#ref_date=' || L_SC_REC.SAMPLING_DATE ||
                        '#field_nr_of_rows=' || L_FIELDNR_OF_ROWS;
                     IF UNAPIEV.P_EV_OUTPUT_ON THEN
                        UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
                     END IF;
                     RAISE STPERROR;
                  END IF;
            
                  
                  
                  UPDATE UTSC
                  SET SC_CLASS=NULL
                  WHERE SC = UNAPIEV.P_SC;
            
               END IF;
            END IF;
         END IF;
         CLOSE L_SC_CURSOR;
      
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'InfoCardDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('InfoCardDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('IcStatusChanged',
                                    'IcCanceled')      THEN
                                   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         
         
         
         

         
         IF UNAPIEV.P_EV_REC.EV_TP = 'IcCanceled' THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   END IF;
EXCEPTION
WHEN OTHERS THEN
   IF L_SCRQSD_CURSOR%ISOPEN THEN
      CLOSE L_SCRQSD_CURSOR;
   END IF;
   IF L_SC_CURSOR%ISOPEN THEN
      CLOSE L_SC_CURSOR;
   END IF;
   IF L_SCIC_COMPLETED_CURSOR%ISOPEN THEN
      CLOSE L_SCIC_COMPLETED_CURSOR;
   END IF;
   RAISE;
END HANDLESCICEVENTS;

PROCEDURE HANDLESCIIEVENTS   
IS      
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'InfoFieldCreated' THEN
                              

      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('InfoFieldCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                          UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
            END IF;
            IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
               L_SQL_STRING := 'UPDATE utscii SET ';
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  IF I < UNAPIGEN.P_DATADOMAINS THEN
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
                  ELSE
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
                  END IF;
               END LOOP;
               L_SQL_STRING := L_SQL_STRING || ' WHERE sc = :sc ' || 
                               'AND ic = :ic ' || 
                               'AND icnode = :icnode ' ||
                               'AND ii = :ii ' || 
                               'AND iinode = :iinode ';

               DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
               END LOOP;
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sc', UNAPIEV.P_SC);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ii', UNAPIEV.P_II);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':iinode', UNAPIEV.P_IINODE);
               L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
            END IF;
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;
            
         UNAPIEV.P_EV_REC.OBJECT_TP := 'ic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'InfoFieldUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'ic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'InfoFieldDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('InfoFieldDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ii' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'ic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'InfoFieldValueChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('InfoFieldValueChanged');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;
         L_RET_CODE := UNAPIEVP.INHERITNEWSPECS(UNAPIEV.P_SC, UNAPIEV.P_II, UNAPIEV.P_NEW_VALUE);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'ic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sc';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sc' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sc';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'st_version='||UNAPIEV.P_ST_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' AND UNAPIEV.P_RQ IS NOT NULL THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;

      
      
      IF UNAPIEV.P_SD IS NOT NULL THEN
         CASCADEONSDLEVEL;
      END IF;

   END IF;
END HANDLESCIIEVENTS;

PROCEDURE HANDLESPECIALEVENTS   
IS

L_GK_VERSION VARCHAR2(20);

BEGIN
   IF UNAPIEV.P_EV_REC.EV_TP IN ('XsltUpdated', 'XsltDeleted') THEN
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'TrendInfoUpdated' THEN
                              
      
      

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

       
      IF UNAPIEV.P_TD_INFO_UNIT = 'SC' THEN
         L_CNT := 0;
         FOR L_SCPATD_REC IN 
            L_SCPATD_CURSOR(UNAPIEV.P_ST, UNAPIEV.P_ST_VERSION, UNAPIEV.P_PG, UNAPIEV.P_PA) LOOP
           
            L_CNT := L_CNT + 1;
            
            IF L_CNT > UNAPIEV.P_TD_INFO THEN
               DELETE FROM UTSCPATD
               WHERE ROWID = L_SCPATD_REC.ROWID;
            END IF;
         END LOOP;
      ELSE
         
         
         
         L_DELETE_OLDER_THAN := NULL;
         IF UNAPIEV.P_TD_INFO_UNIT = 'MI' THEN
            L_DELETE_OLDER_THAN := UNAPIEV2.L_CURRENT_TIMESTAMP - (UNAPIEV.P_TD_INFO/(24*60));
         ELSIF UNAPIEV.P_TD_INFO_UNIT = 'HH' THEN
            L_DELETE_OLDER_THAN := UNAPIEV2.L_CURRENT_TIMESTAMP - (UNAPIEV.P_TD_INFO/24);
         ELSIF UNAPIEV.P_TD_INFO_UNIT = 'DD' THEN
            L_DELETE_OLDER_THAN := UNAPIEV2.L_CURRENT_TIMESTAMP - UNAPIEV.P_TD_INFO;
         ELSIF UNAPIEV.P_TD_INFO_UNIT = 'MM' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(UNAPIEV2.L_CURRENT_TIMESTAMP ,-UNAPIEV.P_TD_INFO);
         ELSIF UNAPIEV.P_TD_INFO_UNIT = 'YY' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(UNAPIEV2.L_CURRENT_TIMESTAMP ,(-UNAPIEV.P_TD_INFO*12));
         ELSIF UNAPIEV.P_TD_INFO_UNIT = 'WW' THEN
            L_CURR_DIFF := 0;
            L_PREV_WEEK_NR := -1;
            FOR L_WEEK_REC IN L_WEEK_CURSOR(UNAPIEV2.L_CURRENT_TIMESTAMP) LOOP
               IF L_WEEK_REC.WEEK_NR <> L_PREV_WEEK_NR THEN
                  L_CURR_DIFF := L_CURR_DIFF + 1;
                  L_DELETE_OLDER_THAN := L_WEEK_REC.DAY_OF_YEAR;
                  L_PREV_WEEK_NR := L_WEEK_REC.WEEK_NR;
               END IF;
               EXIT WHEN L_CURR_DIFF-1 >= UNAPIEV.P_TD_INFO;         
            END LOOP;
         END IF;               
         IF L_DELETE_OLDER_THAN IS NOT NULL THEN
            DELETE UTSCPATD A
            WHERE A.ST = UNAPIEV.P_ST
              AND A.ST_VERSION = UNAPIEV.P_ST_VERSION
              AND A.PA = UNAPIEV.P_PA
              AND A.EXEC_END_DATE < L_DELETE_OLDER_THAN;
         END IF;
      END IF;
   
   
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'ScShelfLifeExceeded' THEN
                                 
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      SELECT ACTIVE,ALLOW_MODIFY
      INTO L_ACTIVE, L_ALLOW_MODIFY
      FROM   UTSC
      WHERE  SC = UNAPIEV.P_SC;
   
      IF L_ACTIVE <> '0' OR L_ALLOW_MODIFY <> '0' THEN
         L_GK_VERSION := UNVERSION.P_NO_VERSION;
         L_SVGK_VALUE(1) := TO_CHAR(TRUNC(CURRENT_TIMESTAMP, 'DD'),UNAPIGEN.P_DATEFORMAT);
         
         L_RET_CODE := UNAPISCP.SAVE1SCGROUPKEY(UNAPIEV.P_SC, 'shelf_life_exceeded',
                                                L_GK_VERSION, L_SVGK_VALUE, 1, '');
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG(
               'Save1ScGroupKey#return=' || TO_CHAR(L_RET_CODE) ||
               '#sc=' || UNAPIEV.P_SC || 
               '#gk=shelf_life_exceeded' || 
               '#gk_version=' || L_GK_VERSION || 
               '#nr_of_rows=' || TO_CHAR(L_NR_OF_ROWS));
         END IF;
         IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV2.L_SQLERRM :=  
             'Save1ScGroupKey#return=' || TO_CHAR(L_RET_CODE) ||
             '#sc=' || UNAPIEV.P_SC || 
             '#gk=shelf_life_exceeded' || 
             '#gk_version=' || L_GK_VERSION || 
             '#nr_of_rows=' || TO_CHAR(L_NR_OF_ROWS);
            RAISE STPERROR;
         END IF;

      END IF;
   END IF;
END HANDLESPECIALEVENTS;

PROCEDURE HANDLERQICEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoCardCreated' THEN
                              

      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqInfoCardCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                       UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
         END IF;
         IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
            L_SQL_STRING := 'UPDATE utrqic SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE rq = :rq ' || 
                            'AND ic = :ic ' || 
                            'AND icnode = :icnode ';
            DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':rq', UNAPIEV.P_RQ);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
            L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
         END IF;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('RqInfoCardUpdated',
                                    'RqInfoCardCopied',
                                    'RqIcLifeCycleChanged',
                                    'RqIcAttributesUpdated',
                                    'RqIcAccessRightsUpdated',
                                    'RqInfoFieldValuesChanged') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         
         
         OPEN L_RQ_CURSOR(UNAPIEV.P_RQ);
         FETCH L_RQ_CURSOR INTO L_RQ_REC;
         IF L_RQ_CURSOR%NOTFOUND THEN
               UNAPIEV2.L_SQLERRM := 'rq ' || UNAPIEV.P_RQ || ' does not exist !' ;
               IF UNAPIEV.P_EV_OUTPUT_ON THEN
                  UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
               END IF;
            RAISE STPERROR;
         ELSE
            IF L_RQ_REC.RQ_CLASS = '1' THEN
               OPEN L_RQIC_COMPLETED_CURSOR(UNAPIEV.P_RQ, UNAPIEV.P_IC, UNAPIEV.P_ICNODE);
               FETCH L_RQIC_COMPLETED_CURSOR INTO L_RQIC_COMPLETED_REC;
               CLOSE L_RQIC_COMPLETED_CURSOR;
          
               IF L_RQIC_COMPLETED_REC.FILLED_IN = L_RQIC_COMPLETED_REC.TOTAL THEN
                  L_FIELDNR_OF_ROWS := 0;
                  L_RET_CODE := UNAPIRQ.CREATERQSAMPLINGDETAILS
                                  (L_RQ_REC.RT, L_RQ_REC.RT_VERSION, UNAPIEV.P_RQ,
                                   UNAPIGEN.PERFORM_FREQ_FILTERING,
                                   L_RQ_REC.SAMPLING_DATE, L_RQ_REC.ADD_STPP, UNAPIEV.P_EV_REC.USERNAME,
                                   L_FIELDTYPE_TAB, L_FIELDNAMES_TAB, L_FIELDVALUES_TAB, L_FIELDNR_OF_ROWS,
                                   'Infocard completed');
                  IF UNAPIEV.P_EV_OUTPUT_ON THEN
                     UNTRACE.LOG('CreateRqSamplingDetails called for '|| UNAPIEV.P_RQ);
                  END IF;
                  IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
                     UNAPIEV2.L_SQLERRM :=  
                        'CreateRqSamplingDetails#return=' || TO_CHAR(L_RET_CODE) ||
                        '#rq=' || UNAPIEV.P_RQ || 
                        '#rt=' || L_RQ_REC.RT || 
                        '#rt_version=' || L_RQ_REC.RT_VERSION || 
                        '#freq_filt=' || UNAPIGEN.PERFORM_FREQ_FILTERING ||
                        '#ref_date=' || L_RQ_REC.SAMPLING_DATE||
                        '#add_stpp=' || L_RQ_REC.ADD_STPP;
                     IF UNAPIEV.P_EV_OUTPUT_ON THEN
                        UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
                     END IF;
                     RAISE STPERROR;
                  END IF;

                  
                  
                  UPDATE UTRQ
                  SET RQ_CLASS=NULL
                  WHERE RQ = UNAPIEV.P_RQ;
            
               END IF;
            END IF;
         END IF;
         CLOSE L_RQ_CURSOR;
      
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoCardDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqInfoCardDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('RqIcStatusChanged',
                                    'RqIcCanceled')        THEN
                                   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         
         
         
         

         
         IF UNAPIEV.P_EV_REC.EV_TP = 'RqIcCanceled' THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
   
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   END IF;
EXCEPTION
WHEN OTHERS THEN
   IF L_RQ_CURSOR%ISOPEN THEN
      CLOSE L_RQ_CURSOR;
   END IF;
   IF L_RQIC_COMPLETED_CURSOR%ISOPEN THEN
      CLOSE L_RQIC_COMPLETED_CURSOR;
   END IF;
   RAISE;
END HANDLERQICEVENTS;

PROCEDURE HANDLERQIIEVENTS   
IS
BEGIN  
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoFieldCreated' THEN
                              

      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqInfoFieldCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                          UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
            END IF;
            IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
               L_SQL_STRING := 'UPDATE utrqii SET ';
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  IF I < UNAPIGEN.P_DATADOMAINS THEN
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
                  ELSE
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
                  END IF;
               END LOOP;
               L_SQL_STRING := L_SQL_STRING || ' WHERE rq = :rq ' || 
                               'AND ic = :ic ' || 
                               'AND icnode = :icnode ' ||
                               'AND ii = :ii ' || 
                               'AND iinode = :iinode ';

               DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
               END LOOP;
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':rq', UNAPIEV.P_RQ);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ii', UNAPIEV.P_II);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':iinode', UNAPIEV.P_IINODE);
               L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
            END IF;
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;
      
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rqic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoFieldUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rqic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoFieldDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqInfoFieldDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqii' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'rqic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'RqInfoFieldValueChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('RqInfoFieldValueChanged');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rqic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rqic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rqic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'rq';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_RQ;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'rq' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'rq';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'rt_version='||UNAPIEV.P_RT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   END IF;
END HANDLERQIIEVENTS;

PROCEDURE HANDLEEQEVENTS   
IS
BEGIN
   
   
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP IN ('EqWarnLevelChanged',
                                 'EqCaWarnLevelChanged' ) THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
          UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      
      
      

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.P_EQSC_EVALEQLC := FALSE; 

      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'eq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'version='||UNAPIEV.P_VERSION||'#lab='||UNAPIEV.P_LAB;
      END IF;

      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'EqCaMethodCreated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
          UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      
      
      
      

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.P_EQSC_EVALEQLC := FALSE; 

      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'eq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'version='||UNAPIEV.P_VERSION||'#lab='||UNAPIEV.P_LAB;
      END IF;

      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'EquipmentUsed' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
          UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.P_EQSC_EVALEQLC := FALSE; 
            
      
      L_RET_CODE := UNAPIEQM.EVALCOUNTBASEDEQCARULES(UNAPIEV.P_EQ, UNAPIEV.P_LAB);
      IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS AND
         UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG( 'EvalCountBasedEqCaRules#return=' || TO_CHAR(L_RET_CODE)
                || '#eq=' || UNAPIEV.P_EQ);
      END IF;
      SAVEPOINT_UNILAB4;
      
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'eq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'version='||UNAPIEV.P_VERSION||'#lab='||UNAPIEV.P_LAB;
      END IF;

      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('EqConstantsCreated',
                                    'EqExecRightsUpdated',
                                    'EqExecRightsCreated',
                                    'EqCalibrationUpdated',
                                    'EqCalibrationCreated',
                                    'EqCommunicationUpdated',
                                    'EqCommunicationCreated',
                                    'EqMeasurementRangesUpdated',
                                    'EqMeasurementRangesCreated') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.P_EQSC_EVALEQLC := FALSE; 
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'eq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'version='||UNAPIEV.P_VERSION||'#lab='||UNAPIEV.P_LAB;
      END IF;

      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

  ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('Eq1ConstantCreated',
                                   'Eq1ConstantUpdated',
                                   'EqConstantsUpdated') THEN
                                  
   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
     
      

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.P_EQSC_EVALEQLC := FALSE; 
      

      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'eq';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'version='||UNAPIEV.P_VERSION||'#lab='||UNAPIEV.P_LAB;
      END IF;

      UNAPIEV.UPDATEOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

      
      
      OPEN L_EQ_CURSOR(UNAPIEV.P_EQ, UNAPIEV.P_LAB);
      FETCH L_EQ_CURSOR INTO L_EQ_REC;
      CLOSE L_EQ_CURSOR;
         
      
      L_DELETE_OLDER_THAN := NULL;
      IF NVL(L_EQ_REC.KEEP_CTOLD_UNIT, 'CT') = 'CT' THEN
         FOR L_EQCTLIST_REC IN L_EQCTLIST_CURSOR(UNAPIEV.P_EQ, UNAPIEV.P_LAB) LOOP
            L_CNT := 0;
            L_DELETE_OLDER_THAN := NULL;
            FOR L_EQCTOLD_REC IN L_EQCTOLD_CURSOR(UNAPIEV.P_EQ, UNAPIEV.P_LAB, L_EQCTLIST_REC.SEQ) LOOP
               L_CNT := L_CNT + 1;
               IF L_CNT > L_EQ_REC.KEEP_CTOLD THEN
                  L_DELETE_OLDER_THAN := L_EQCTOLD_REC.EXEC_START_DATE;
                  EXIT;
               END IF;
            END LOOP;
            IF L_DELETE_OLDER_THAN IS NOT NULL THEN                           
               DELETE UTEQCTOLD A
               WHERE A.EQ = UNAPIEV.P_EQ
                 AND A.LAB = UNAPIEV.P_LAB
                 AND A.SEQ = L_EQCTLIST_REC.SEQ
                 AND A.EXEC_START_DATE < L_DELETE_OLDER_THAN;                       
            END IF;
         END LOOP;         
      ELSE
         
         
         
         IF L_EQ_REC.KEEP_CTOLD_UNIT = 'MI' THEN
            L_DELETE_OLDER_THAN := TRUNC(UNAPIEV2.L_CURRENT_TIMESTAMP, 'MI') - (L_EQ_REC.KEEP_CTOLD/(24*60));
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'HH' THEN
            L_DELETE_OLDER_THAN := TRUNC(UNAPIEV2.L_CURRENT_TIMESTAMP, 'HH') - (L_EQ_REC.KEEP_CTOLD/24);
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'DD' THEN
            L_DELETE_OLDER_THAN := TRUNC(UNAPIEV2.L_CURRENT_TIMESTAMP, 'DD') - L_EQ_REC.KEEP_CTOLD;
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'MM' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(TRUNC(UNAPIEV2.L_CURRENT_TIMESTAMP, 'MM') ,-L_EQ_REC.KEEP_CTOLD);
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'FM' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(UNAPIEV2.L_CURRENT_TIMESTAMP ,-L_EQ_REC.KEEP_CTOLD);
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'YY' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(TRUNC(UNAPIEV2.L_CURRENT_TIMESTAMP, 'YY') ,(-L_EQ_REC.KEEP_CTOLD*12));
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'FY' THEN
            L_DELETE_OLDER_THAN := ADD_MONTHS(UNAPIEV2.L_CURRENT_TIMESTAMP ,(-L_EQ_REC.KEEP_CTOLD*12));
         ELSIF L_EQ_REC.KEEP_CTOLD_UNIT = 'WW' THEN
            L_CURR_DIFF := 0;
            L_PREV_WEEK_NR := -1;
            FOR L_WEEK_REC IN L_WEEK_CURSOR(UNAPIEV2.L_CURRENT_TIMESTAMP) LOOP
               IF L_WEEK_REC.WEEK_NR <> L_PREV_WEEK_NR THEN
                  L_CURR_DIFF := L_CURR_DIFF + 1;
                  L_DELETE_OLDER_THAN := L_WEEK_REC.DAY_OF_YEAR;
                  L_PREV_WEEK_NR := L_WEEK_REC.WEEK_NR;
               END IF;
               EXIT WHEN L_CURR_DIFF-1 >= L_EQ_REC.KEEP_CTOLD;         
            END LOOP;
         END IF;               
            
         
         
         IF L_DELETE_OLDER_THAN IS NOT NULL THEN                           
            DELETE UTEQCTOLD A
            WHERE A.EQ = UNAPIEV.P_EQ
              AND A.LAB = UNAPIEV.P_LAB
              AND A.EXEC_START_DATE < L_DELETE_OLDER_THAN;                       
         END IF;
      END IF;                
   END IF;
EXCEPTION
WHEN OTHERS THEN
   IF L_EQ_CURSOR%ISOPEN THEN
      CLOSE L_EQ_CURSOR;
   END IF;
   RAISE;
END HANDLEEQEVENTS;

FUNCTION ISTHEMETHODREADY4COMPLETION                              
(A_SC                           IN     VARCHAR2,                  
 A_PG                           IN     VARCHAR2,                  
 A_PGNODE                       IN     NUMBER,                    
 A_PA                           IN     VARCHAR2,                  
 A_PANODE                       IN     NUMBER,                    
 A_ME                           IN     VARCHAR2,                  
 A_MENODE                       IN     NUMBER,                    
 A_METHOD_IS_READY4COMPLETION   OUT    CHAR)                      
RETURN NUMBER IS

CURSOR L_MECELLOUTPUT_CURSOR (A_SC VARCHAR2,
                        A_PG VARCHAR2, A_PGNODE NUMBER,
                        A_PA VARCHAR2, A_PANODE NUMBER,
                        A_ME VARCHAR2, A_MENODE NUMBER)  IS
   SELECT A.*, B.VALUE_F VALUE_F, B.VALUE_S VALUE_S, B.CELL_TP CELL_TP
   FROM UTSCMECELLOUTPUT A, UTSCMECELL B
   WHERE A.SC = A_SC
     AND A.PG = A_PG
     AND A.PGNODE = A_PGNODE
     AND A.PA = A_PA
     AND A.PANODE = A_PANODE
     AND A.ME = A_ME
     AND A.MENODE = A_MENODE
     AND A.SC = B.SC
     AND A.PG = B.PG
     AND A.PGNODE = B.PGNODE
     AND A.PA = B.PA
     AND A.PANODE = B.PANODE
     AND A.ME = B.ME
     AND A.MENODE = B.MENODE
     AND A.CELL = B.CELL;

CURSOR L_MECELLLIST_L_CURSOR (A_SC VARCHAR2,
                        A_PG VARCHAR2, A_PGNODE NUMBER,
                        A_PA VARCHAR2, A_PANODE NUMBER,
                        A_ME VARCHAR2, A_MENODE NUMBER,
                        A_CELL VARCHAR2) IS
   SELECT VALUE_S, VALUE_F 
   FROM UTSCMECELLLIST
   WHERE SC = A_SC
   AND PG = A_PG
   AND PGNODE = A_PGNODE
   AND PA = A_PA
   AND PANODE = A_PANODE
   AND ME = A_ME
   AND MENODE = A_MENODE
   AND CELL = A_CELL
   AND SELECTED <> '0'
   ORDER BY INDEX_X, INDEX_Y;
L_MECELLLIST_L_REC   L_MECELLLIST_L_CURSOR%ROWTYPE;

CURSOR L_MECELLLIST_T_CURSOR (A_SC VARCHAR2,
                        A_PG VARCHAR2, A_PGNODE NUMBER,
                        A_PA VARCHAR2, A_PANODE NUMBER,
                        A_ME VARCHAR2, A_MENODE NUMBER,
                        A_CELL VARCHAR2) IS
   SELECT INDEX_Y,
          MAX(DECODE(INDEX_X, 0, VALUE_S)) OBJECT_ID,
          MAX(DECODE(INDEX_X, 1, VALUE_S)) VALUE_S,
          MAX(DECODE(INDEX_X, 1, VALUE_F)) VALUE_F
   FROM UTSCMECELLLIST
   WHERE SC = A_SC
   AND PG = A_PG
   AND PGNODE = A_PGNODE
   AND PA = A_PA
   AND PANODE = A_PANODE
   AND ME = A_ME
   AND MENODE = A_MENODE
   AND CELL = A_CELL
   AND INDEX_X IN (0,1)
   GROUP BY INDEX_Y
   HAVING (MAX(DECODE(INDEX_X, 1, VALUE_S))  IS NOT NULL
           OR MAX(DECODE(INDEX_X, 1, VALUE_F))  IS NOT NULL)
   ORDER BY INDEX_Y;
L_MECELLLIST_T_REC   L_MECELLLIST_T_CURSOR%ROWTYPE;
L_ALL_CELLS_COMPLETED  BOOLEAN;

BEGIN
   L_ALL_CELLS_COMPLETED := TRUE;
   FOR L_MECELLOUTPUT_REC 
      IN L_MECELLOUTPUT_CURSOR(A_SC, A_PG, A_PGNODE,  A_PA, A_PANODE, A_ME, A_MENODE) LOOP
      L_ALL_CELLS_COMPLETED := TRUE;
      IF L_MECELLOUTPUT_REC.CELL_TP NOT IN ('T', 'L') THEN
         IF L_MECELLOUTPUT_REC.VALUE_F IS NULL AND L_MECELLOUTPUT_REC.VALUE_S IS NULL THEN
            L_ALL_CELLS_COMPLETED := FALSE;
            EXIT;
         END IF;
      ELSIF L_MECELLOUTPUT_REC.CELL_TP = 'L' THEN
         OPEN L_MECELLLIST_L_CURSOR(A_SC, A_PG, A_PGNODE,  A_PA, A_PANODE, 
                                    A_ME, A_MENODE, L_MECELLOUTPUT_REC.CELL);
         FETCH L_MECELLLIST_L_CURSOR
         INTO L_MECELLLIST_L_REC;
         IF L_MECELLLIST_L_CURSOR%NOTFOUND THEN
            L_ALL_CELLS_COMPLETED := FALSE;
            CLOSE L_MECELLLIST_L_CURSOR;
            EXIT;
         END IF;
         CLOSE L_MECELLLIST_L_CURSOR;
      ELSIF L_MECELLOUTPUT_REC.CELL_TP = 'T' THEN
         OPEN L_MECELLLIST_T_CURSOR(A_SC, A_PG, A_PGNODE,  A_PA, A_PANODE, 
                                    A_ME, A_MENODE, L_MECELLOUTPUT_REC.CELL);
         FETCH L_MECELLLIST_T_CURSOR
         INTO L_MECELLLIST_T_REC;
         IF L_MECELLLIST_T_CURSOR%NOTFOUND THEN
            L_ALL_CELLS_COMPLETED := FALSE;
            CLOSE L_MECELLLIST_T_CURSOR;
            EXIT;
         END IF;
         CLOSE L_MECELLLIST_T_CURSOR;
      END IF;
   END LOOP;

   IF L_ALL_CELLS_COMPLETED THEN
      
      A_METHOD_IS_READY4COMPLETION := '1';
   ELSE
      A_METHOD_IS_READY4COMPLETION := '0';   
   END IF;
   RETURN(UNAPIGEN.DBERR_SUCCESS);
   
END ISTHEMETHODREADY4COMPLETION;

PROCEDURE CHECK4HANDLESCMECELLOUTPUT
IS

CURSOR L_SS_CURSOR(C_SS VARCHAR2) IS
   SELECT ALLOW_MODIFY
     FROM UTSS
    WHERE SS = C_SS;
L_ALLOW_MODIFY       CHAR(1);

CURSOR L_WS_CURSOR(C_WS VARCHAR2) IS
   SELECT WS_CLASS
     FROM UTWS
    WHERE WS = C_WS;

CURSOR L_WSME_CURSOR(C_WS IN VARCHAR2, A_CHECK_CONFIRM_COMPLETE_OFF IN CHAR) IS
   SELECT A.*, B.MT_VERSION
     FROM UTSCME B, UTWSME A
    WHERE A.WS = C_WS
    AND A.SC = B.SC
    AND A.PG = B.PG
    AND A.PGNODE = B.PGNODE
    AND A.PA = B.PA
    AND A.PANODE = B.PANODE
    AND A.ME = B.ME
    AND A.MENODE = B.MENODE
    AND A.REANALYSIS = B.REANALYSIS
    AND B.EXEC_END_DATE IS NULL
    AND B.CONFIRM_COMPLETE = DECODE(A_CHECK_CONFIRM_COMPLETE_OFF,'1', '0', B.CONFIRM_COMPLETE);
    

CURSOR L_CELLOUTPUT_CURSOR(C_SC VARCHAR2, 
                           C_PG VARCHAR2, C_PGNODE NUMBER,
                           C_PA VARCHAR2, C_PANODE NUMBER,
                           C_ME VARCHAR2, C_MENODE NUMBER) IS
   SELECT COUNT(*)
     FROM UTSCMECELLOUTPUT
    WHERE SC     = C_SC 
      AND PG     = C_PG
      AND PGNODE = C_PGNODE
      AND PA     = C_PA
      AND PANODE = C_PANODE
      AND ME     = C_ME
      AND MENODE = C_MENODE;
L_CELLOUTPUT_COUNT             NUMBER;
L_WS_CLASS                     CHAR(1);
L_METHOD_IS_READY4COMPLETION   CHAR(1);

BEGIN
   
   OPEN L_SS_CURSOR(UNAPIEV.P_SS_TO);
   FETCH L_SS_CURSOR INTO L_ALLOW_MODIFY;
   CLOSE L_SS_CURSOR;
      
   
   IF L_ALLOW_MODIFY = '0' THEN
      
      FOR L_WSME_REC IN L_WSME_CURSOR(UNAPIEV.P_WS, '0') LOOP
         

         
            OPEN L_CELLOUTPUT_CURSOR(L_WSME_REC.SC,
                                     L_WSME_REC.PG, L_WSME_REC.PGNODE,
                                     L_WSME_REC.PA, L_WSME_REC.PANODE,
                                     L_WSME_REC.ME, L_WSME_REC.MENODE);
            FETCH L_CELLOUTPUT_CURSOR INTO L_CELLOUTPUT_COUNT;
            CLOSE L_CELLOUTPUT_CURSOR;

         
         IF (L_CELLOUTPUT_COUNT > 0) THEN
            L_RET_CODE := UNAPIME5.HANDLESCMECELLOUTPUT(L_WSME_REC.SC,
                                                        L_WSME_REC.PG, L_WSME_REC.PGNODE,
                                                        L_WSME_REC.PA, L_WSME_REC.PANODE,
                                                        L_WSME_REC.ME, L_WSME_REC.MENODE, 
                                                        L_WSME_REC.REANALYSIS);
            IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
               RAISE STPERROR;
            END IF;
         ELSE
            L_EV_SEQ_NR := -1;
            L_EVENT_TP := 'WorksheetCompleted';
            L_EV_DETAILS := 'sc=' || L_WSME_REC.SC || 
                            '#pg=' || L_WSME_REC.PG || '#pgnode=' || TO_CHAR(L_WSME_REC.PGNODE) || 
                            '#pa=' || L_WSME_REC.PA || '#panode=' || TO_CHAR(L_WSME_REC.PANODE) || 
                            '#menode=' || TO_CHAR(L_WSME_REC.MENODE) ||
                            '#mt_version=' || L_WSME_REC.MT_VERSION;
            L_RESULT := UNAPIEV.INSERTEVENT('Check4HandleScMeCellOutput', UNAPIGEN.P_EVMGR_NAME,
                                            'me', L_WSME_REC.ME, '', '', '',
                                             L_EVENT_TP, L_EV_DETAILS, L_EV_SEQ_NR);
         END IF;
      END LOOP;
   ELSE
      
      OPEN L_WS_CURSOR(UNAPIEV.P_WS);
      FETCH L_WS_CURSOR INTO L_WS_CLASS;
      CLOSE L_WS_CURSOR;

      IF L_WS_CLASS = '1' THEN 
         
         FOR L_WSME_REC IN L_WSME_CURSOR(UNAPIEV.P_WS, '1') LOOP
            

            
            L_METHOD_IS_READY4COMPLETION := '0';
               
               L_RET_CODE := ISTHEMETHODREADY4COMPLETION(L_WSME_REC.SC,
                                                         L_WSME_REC.PG, L_WSME_REC.PGNODE,
                                                         L_WSME_REC.PA, L_WSME_REC.PANODE,
                                                         L_WSME_REC.ME, L_WSME_REC.MENODE,
                                                         L_METHOD_IS_READY4COMPLETION);
               IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
                  UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
                  RAISE STPERROR;
               END IF;
               
               IF L_METHOD_IS_READY4COMPLETION = '1' THEN
                  L_RET_CODE := UNAPIME5.HANDLESCMECELLOUTPUT(L_WSME_REC.SC,
                                                              L_WSME_REC.PG, L_WSME_REC.PGNODE,
                                                              L_WSME_REC.PA, L_WSME_REC.PANODE,
                                                              L_WSME_REC.ME, L_WSME_REC.MENODE, 
                                                              L_WSME_REC.REANALYSIS);
                  IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
                     UNAPIGEN.P_TXN_ERROR := L_RET_CODE;
                     RAISE STPERROR;
                  END IF;               
               END IF;
         END LOOP;
      END IF;
   END IF;
END CHECK4HANDLESCMECELLOUTPUT;

PROCEDURE HANDLEWSEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'WorksheetCreated' THEN
                               
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         
         DELETEUCAUDITTRAIL('ws', UNAPIEV.P_WS);
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'wt_version='||UNAPIEV.P_WT_VERSION;

            
            
            CHECK4HANDLESCMECELLOUTPUT;
         END IF;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                       UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
         END IF;
         IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
            L_SQL_STRING := 'UPDATE utws SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE ws = :ws ' ; 

            DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ws', UNAPIEV.P_WS);
            L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
         END IF;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'WsStatusChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         
         
         
         

         
         
         CHECK4HANDLESCMECELLOUTPUT;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'WsCanceled' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         
         
         
         

         
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'wt_version='||UNAPIEV.P_WT_VERSION;

         
         
         CHECK4HANDLESCMECELLOUTPUT;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'WsLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('WsLifeCycleChanged');
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'wt_version='||UNAPIEV.P_WT_VERSION;

            
            
            CHECK4HANDLESCMECELLOUTPUT;
         END IF;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;
      
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'WsDetailsUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         
         
         
         
         
         
         UNAPIEV3.UPDATEWSALLDATES(TRUE, TRUE);
         
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'wt_version='||UNAPIEV.P_WT_VERSION;

            
            
            CHECK4HANDLESCMECELLOUTPUT;
         END IF;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;
      
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('WorksheetUpdated', 
         'WsGroupKeyUpdated',
         'WsAttributesUpdated',
         'WsAccessRightsUpdated',
         'WorksheetImported') THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'wt_version='||UNAPIEV.P_WT_VERSION;

            
            
            CHECK4HANDLESCMECELLOUTPUT;
         END IF;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('WsRowCreated',
         'WsRowUpdated',
         'WsRowDeleted',
         'WsSampleCreated') THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         

         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'ws';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'wt_version='||UNAPIEV.P_WT_VERSION;

            
            
            CHECK4HANDLESCMECELLOUTPUT;
         END IF;

         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         
         
         CHECK4HANDLESCMECELLOUTPUT;
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'WorksheetDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'ws' THEN
         
         
         
         NULL;
      END IF;
   END IF;        
END HANDLEWSEVENTS;

PROCEDURE HANDLESDEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP IN ('StudyCreated',
                                 'StudyPlanned') THEN
                                
   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      DELETEUCAUDITTRAIL('sd', UNAPIEV.P_SD);

      
      OPEN L_SD_CURSOR(UNAPIEV.P_SD);
      FETCH L_SD_CURSOR INTO L_SD_REC;
      IF L_SD_CURSOR%NOTFOUND THEN
         CLOSE L_SD_CURSOR;
         UNAPIEV2.L_SQLERRM := 'sd ' || UNAPIEV.P_SD || ' does not exist !' ;
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
         END IF;
         RAISE STPERROR;
      ELSE            
         CLOSE L_SD_CURSOR;
         IF L_SD_REC.SD_CLASS <> '1' OR 
            L_SD_REC.SD_CLASS IS NULL THEN
      
            
            
            UPDATE UTSD
            SET ALLOW_MODIFY='1'
            WHERE SD = UNAPIEV.P_SD
            RETURNING PT, PT_VERSION
            INTO UNAPIEV.P_PT, UNAPIEV.P_PT_VERSION; 
            L_FIELDNR_OF_ROWS := 1;
            L_FIELDTYPE_TAB(1) := 'sd';
            L_FIELDNAMES_TAB(1) := 'sd';
            L_FIELDVALUES_TAB(1) := UNAPIEV.P_SD;
            L_RET_CODE := UNAPISD.CREATESDSAMPLINGDETAILS
                             (UNAPIEV.P_PT, UNAPIEV.P_PT_VERSION, UNAPIEV.P_SD,
                              UNAPIGEN.PERFORM_FREQ_FILTERING,
                              CURRENT_TIMESTAMP, UNAPIEV.P_EV_REC.USERNAME,
                              L_FIELDTYPE_TAB, L_FIELDNAMES_TAB, L_FIELDVALUES_TAB, L_FIELDNR_OF_ROWS,
                              '');
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG('CreateSdSamplingDetails called for '|| UNAPIEV.P_SD);
            END IF;
            IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV2.L_SQLERRM :=  
                  'CreateSdSamplingDetails#return=' || TO_CHAR(L_RET_CODE) ||
                  '#sd=' || UNAPIEV.P_SD || 
                  '#pt=' || UNAPIEV.P_PT || '#pt_version=' || UNAPIEV.P_PT_VERSION || 
                  '#freq_filt=' || UNAPIGEN.PERFORM_FREQ_FILTERING ||
                  '#ref_date=' || UNAPIEV2.L_CURRENT_TIMESTAMP ||
                  '#user=' || UNAPIEV.P_EV_REC.USERNAME;
               IF UNAPIEV.P_EV_OUTPUT_ON THEN
                  UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
               END IF;
               RAISE STPERROR;
            END IF;
         END IF;
      END IF;
      
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                    UNAPIEV.P_EV_REC.OBJECT_ID, 
                                                    L_AR);
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
      END IF;
      IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
         L_SQL_STRING := 'UPDATE utsd SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE sd = :sd ' ; 
                         
         DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sd', UNAPIEV.P_SD);
         L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
      END IF;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('SdStatusChanged',
                                    'SdCanceled')      THEN
                                   
      
      
      
      
      
      
      IF UNAPIEV.P_EV_REC.EV_TP = 'SdCanceled' THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
      L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdLifeCycleChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdLifeCycleChanged');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                             UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'T0_dateSet' THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      L_RET_CODE := UNAPISD.EVALUATESDCSTIMEPOINTS(UNAPIEV.P_SD, UNAPIEV.P_CSNODE);
      IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
         IF  UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('EvaluateSdCsTimePoints#return=' || TO_CHAR(L_RET_CODE) ||
                        '#sd='||UNAPIEV.P_SD || '#csnode=NULL');
         END IF;
         UNAPIGEN.LOGERROR(SUBSTR('Ev~'||TO_CHAR(UNAPIEV.P_EV_REC.EV_SEQ)||'~'||UNAPIEV.P_EV_REC.EV_TP,1,40),
                           'EvaluateSdCsTimePoints#return=' || TO_CHAR(L_RET_CODE) ||
                           '#sd='||UNAPIEV.P_SD || '#csnode=NULL');
      END IF;
      
      
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('StudyUpdated', 
         'SdAttributesUpdated',
         'SdAccessRightsUpdated', 
         'SdGroupKeyUpdated',
         'SdInfoCreated', 
         'SdSampleCreated', 
         'SdPpUpdated',
         'SdPpAttributesUpdated',
         'SdCellSamplesUpdated',
         'SdTimePointsUpdated',
         'SdConditionSetsUpdated',
         'SdCellSampleAdded',
         'SdCellSampleLocationUpdated',
         'SdCellSampleDeleted',
         'SdCsConditionUpdated',
         'SdCellSampleLocationEnded',
         'StudyImported') THEN
        
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP IN
        ('Sd1SampleAdded',
         'SdSamplesAdded') THEN
       
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      
      
      

      
      
      
      
      
      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);

   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdSampleRemoved' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdSampleRemoved');
      END IF;

      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      
      
      
      

      L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

      
      IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
         UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
         UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
            'pt_version='||UNAPIEV.P_PT_VERSION;
      END IF;
         
      UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
      L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                     UNAPIEV.P_TR_NO, L_TRANSITION_OK);
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'StudyDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
      
      
      
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;
      NULL;
   END IF;
END HANDLESDEVENTS;

PROCEDURE HANDLESDICEVENTS   
IS
BEGIN
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoCardCreated' THEN
                              

      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdInfoCardCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                       UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
         IF UNAPIEV.P_EV_OUTPUT_ON THEN
            UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
         END IF;
         IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
            L_SQL_STRING := 'UPDATE utsdic SET ';
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               IF I < UNAPIGEN.P_DATADOMAINS THEN
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
               ELSE
                  L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
               END IF;
            END LOOP;
            L_SQL_STRING := L_SQL_STRING || ' WHERE sd = :sd ' || 
                            'AND ic = :ic ' || 
                            'AND icnode = :icnode ';
            DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
            FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
               DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
            END LOOP;
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sd', UNAPIEV.P_SD);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
            DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
            L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
         END IF;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('SdInfoCardUpdated',
                                    'SdInfoCardCopied',
                                    'SdIcLifeCycleChanged',
                                    'SdIcAttributesUpdated',
                                    'SdIcAccessRightsUpdated',
                                    'SdInfoFieldValuesChanged') THEN
                                   
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         
         
         OPEN L_SD_CURSOR(UNAPIEV.P_SD);
         FETCH L_SD_CURSOR INTO L_SD_REC;
         IF L_SD_CURSOR%NOTFOUND THEN
            CLOSE L_SD_CURSOR;
            UNAPIEV2.L_SQLERRM := 'sd ' || UNAPIEV.P_SD || ' does not exist !' ;
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
            END IF;
            RAISE STPERROR;
         ELSE            
            CLOSE L_SD_CURSOR;
            IF L_SD_REC.SD_CLASS = '1' THEN
               OPEN L_SDIC_COMPLETED_CURSOR(UNAPIEV.P_SD, UNAPIEV.P_IC, UNAPIEV.P_ICNODE);
               FETCH L_SDIC_COMPLETED_CURSOR INTO L_SDIC_COMPLETED_REC;
               CLOSE L_SDIC_COMPLETED_CURSOR;
          
               IF L_SDIC_COMPLETED_REC.FILLED_IN = L_SDIC_COMPLETED_REC.TOTAL THEN
                  L_FIELDNR_OF_ROWS := 0;
                  L_RET_CODE := UNAPISD.CREATESDSAMPLINGDETAILS
                                  (L_SD_REC.PT, L_SD_REC.PT_VERSION, UNAPIEV.P_SD,
                                   UNAPIGEN.PERFORM_FREQ_FILTERING,
                                   CURRENT_TIMESTAMP, UNAPIEV.P_EV_REC.USERNAME, 
                                   L_FIELDTYPE_TAB, L_FIELDNAMES_TAB, L_FIELDVALUES_TAB, L_FIELDNR_OF_ROWS,
                                   'Infocard completed');
                  IF UNAPIEV.P_EV_OUTPUT_ON THEN
                     UNTRACE.LOG('CreateSdSamplingDetails called for '|| UNAPIEV.P_SD);
                  END IF;
                  IF L_RET_CODE <> UNAPIGEN.DBERR_SUCCESS THEN
                     UNAPIEV2.L_SQLERRM :=  
                        'CreateSdSamplingDetails#return=' || TO_CHAR(L_RET_CODE) ||
                        '#sd=' || UNAPIEV.P_SD || 
                        '#pt=' || L_SD_REC.PT || 
                        '#pt_version=' || L_SD_REC.PT_VERSION || 
                        '#freq_filt=' || UNAPIGEN.PERFORM_FREQ_FILTERING ||
                        '#ref_date=' || CURRENT_TIMESTAMP ||
                        '#userid=' || UNAPIEV.P_EV_REC.USERNAME;
                     IF UNAPIEV.P_EV_OUTPUT_ON THEN
                        UNTRACE.LOG(UNAPIEV2.L_SQLERRM);
                     END IF;
                     RAISE STPERROR;
                  END IF;
                  
                  
                  UPDATE UTSD
                  SET SD_CLASS=NULL
                  WHERE SD = UNAPIEV.P_SD;            
               END IF;
            END IF;
         END IF;
      
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoCardDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdInfoCardDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP IN ('SdIcStatusChanged',
                                    'SdIcCanceled')        THEN
                                   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         
         
         
         

         
         IF UNAPIEV.P_EV_REC.EV_TP = 'SdIcCanceled' THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_EV_REC.OBJECT_SS);
         L_TRANSITION_OK := UNAPIGEN.DBERR_SUCCESS;
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_LC_SS_FROM,UNAPIEV.P_EV_REC.OBJECT_SS,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
   
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   END IF;
EXCEPTION
WHEN OTHERS THEN
   IF L_SD_CURSOR%ISOPEN THEN
      CLOSE L_SD_CURSOR;
   END IF;
   IF L_SDIC_COMPLETED_CURSOR%ISOPEN THEN
      CLOSE L_SDIC_COMPLETED_CURSOR;
   END IF;
   RAISE;
END HANDLESDICEVENTS;

PROCEDURE HANDLESDIIEVENTS   
IS
BEGIN  
   
   
   
   IF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoFieldCreated' THEN
                              

      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdInfoFieldCreated');
      END IF;
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNACCESS.INITOBJECTACCESSRIGHTS(UNAPIEV.P_EV_REC.OBJECT_TP,
                                                          UNAPIEV.P_EV_REC.OBJECT_ID, L_AR);
            IF UNAPIEV.P_EV_OUTPUT_ON THEN
               UNTRACE.LOG('      InitObjectAR: '|| L_RET_CODE);
            END IF;
            IF L_RET_CODE = UNAPIGEN.DBERR_SUCCESS THEN
               L_SQL_STRING := 'UPDATE utsdii SET ';
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  IF I < UNAPIGEN.P_DATADOMAINS THEN
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I || ', ';
                  ELSE
                     L_SQL_STRING := L_SQL_STRING || 'ar' || I || ' = :ar' || I;
                  END IF;
               END LOOP;
               L_SQL_STRING := L_SQL_STRING || ' WHERE sd = :sd ' || 
                               'AND ic = :ic ' || 
                               'AND icnode = :icnode ' ||
                               'AND ii = :ii ' || 
                               'AND iinode = :iinode ';

               DBMS_SQL.PARSE(UNAPIEV.L_OBJ_CURSOR, L_SQL_STRING, DBMS_SQL.V7); 
               FOR I IN 1..UNAPIGEN.P_DATADOMAINS LOOP
                  DBMS_SQL.BIND_VARIABLE_CHAR(UNAPIEV.L_OBJ_CURSOR, ':ar'|| I, L_AR(I), 1);
               END LOOP;
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':sd', UNAPIEV.P_SD);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ic', UNAPIEV.P_IC);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':icnode', UNAPIEV.P_ICNODE);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':ii', UNAPIEV.P_II);
               DBMS_SQL.BIND_VARIABLE(UNAPIEV.L_OBJ_CURSOR, ':iinode', UNAPIEV.P_IINODE);
               L_RESULT := DBMS_SQL.EXECUTE(UNAPIEV.L_OBJ_CURSOR);
            END IF;
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;
      
         UNAPIEV.P_EV_REC.OBJECT_TP := 'sdic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoFieldUpdated' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG(UNAPIEV.P_EV_REC.EV_TP);
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sdic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoFieldDeleted' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdInfoFieldDeleted');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdii' THEN
         
         
         
         
         UNAPIEV.P_EV_REC.OBJECT_TP := 'sdic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   ELSIF UNAPIEV.P_EV_REC.EV_TP = 'SdInfoFieldValueChanged' THEN
                                 
      IF UNAPIEV.P_EV_OUTPUT_ON THEN
         UNTRACE.LOG('SdInfoFieldValueChanged');
      END IF;
   
      UNAPIEV2.L_EVENT_PROCESSED := TRUE;

      
      
      
      
      
      
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdii' THEN
         IF UNAPIEV.P_EV_REC.OBJECT_LC IS NOT NULL THEN 
            L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

            
            IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
               UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdii';
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
               UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
                  'ie_version='||UNAPIEV.P_IE_VERSION;
            END IF;

            UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
            L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                           UNAPIEV.P_TR_NO, L_TRANSITION_OK);
         END IF;

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sdic';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_IC;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sdic' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sdic';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'ip_version='||UNAPIEV.P_IP_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);

         UNAPIEV.P_EV_REC.OBJECT_TP := 'sd';
         UNAPIEV.P_EV_REC.OBJECT_ID := UNAPIEV.P_SD;
         UNAPIEV.P_EV_REC.OBJECT_LC := '';
         UNAPIEV.P_EV_REC.OBJECT_LC_VERSION := '';
         UNAPIEV.P_EV_REC.OBJECT_SS := '';
         UNAPIEV.P_SS_TO := '';
      END IF;
   
      
      
      IF UNAPIEV.P_EV_REC.OBJECT_TP = 'sd' THEN
         L_TRANSITION_OK := UNAPIEV.EVALLIFECYCLE(UNAPIEV.P_SS_TO, UNAPIEV.P_TR_NO);

         
         IF L_TRANSITION_OK = UNAPIGEN.DBERR_SUCCESS THEN
            UNAPIEV.P_EV_TR_COUNT := UNAPIEV.P_EV_TR.COUNT + 1;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TP         := 'sd';
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).ID         := UNAPIEV.P_EV_REC.OBJECT_ID;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC         := UNAPIEV.P_EV_REC.OBJECT_LC;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_VERSION := UNAPIEV.P_EV_REC.OBJECT_LC_VERSION;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_FROM    := UNAPIEV.P_EV_REC.OBJECT_SS;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).SS_TO      := UNAPIEV.P_SS_TO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).TR_NO      := UNAPIEV.P_TR_NO;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).LC_SS_FROM := UNAPIEV.P_LC_SS_FROM;
            UNAPIEV.P_EV_TR(UNAPIEV.P_EV_TR_COUNT).EV_DETAILS := 
               'pt_version='||UNAPIEV.P_PT_VERSION;
         END IF;
         
         UNAPIEV.UPDATEOPALOBJECTRECORD(UNAPIEV.P_SS_TO);
         L_RET_CODE := UNAPIEV.EXECUTETRACTIONS(UNAPIEV.P_EV_REC.OBJECT_SS,UNAPIEV.P_SS_TO,
                                        UNAPIEV.P_TR_NO, L_TRANSITION_OK);
      END IF;
   END IF;
END HANDLESDIIEVENTS;

END UNAPIEV3;